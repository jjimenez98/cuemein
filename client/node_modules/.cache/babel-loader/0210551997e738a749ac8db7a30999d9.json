{"ast":null,"code":"/* eslint consistent-return:0 */\n'use strict';\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar ParticipantSignaling = require('./participant');\n\nvar RoomSignaling = require('./room');\n\nvar StateMachine = require('../statemachine');\n/*\nSignaling States\n----------------\n\n              +---------+\n              |         |\n              | opening |\n         +--->|         |\n         |    +---------+\n    +--------+   |   |   +------+\n    |        |<--+   +-->|      |\n    | closed |<----------| open |\n    |        |<--+   +-->|      |\n    +--------+   |   |   +------+\n              +---------+   |\n              |         |<--+\n              | closing |\n              |         |\n              +---------+\n\n*/\n\n\nvar states = {\n  closed: ['opening'],\n  opening: ['closed', 'open'],\n  open: ['closed', 'closing'],\n  closing: ['closed', 'open']\n};\n/**\n * @extends StateMachine\n * @property {string} state - one of \"closed\", \"opening\", \"open\", or \"closing\"\n */\n\nvar Signaling = function (_super) {\n  __extends(Signaling, _super);\n  /**\n   * Construct {@link Signaling}.\n   */\n\n\n  function Signaling() {\n    return _super.call(this, 'closed', states) || this;\n  }\n  /**\n   * @private\n   */\n  // NOTE(mroberts): This is a dummy implementation suitable for testing.\n\n\n  Signaling.prototype._close = function (key) {\n    this.transition('closing', key);\n    this.transition('closed', key);\n    return Promise.resolve(this);\n  };\n  /**\n   * @private\n   */\n  // NOTE(mroberts): This is a dummy implementation suitable for testing.\n\n\n  Signaling.prototype._connect = function (localParticipant, token, encodingParameters, preferredCodecs, options) {\n    localParticipant.connect('PA00000000000000000000000000000000', 'test');\n    var sid = 'RM00000000000000000000000000000000';\n    var promise = Promise.resolve(new RoomSignaling(localParticipant, sid, options));\n\n    promise.cancel = function cancel() {};\n\n    return promise;\n  };\n  /**\n   * @private\n   */\n  // NOTE(mroberts): This is a dummy implementation suitable for testing.\n\n\n  Signaling.prototype._open = function (key) {\n    this.transition('opening', key);\n    this.transition('open', key);\n    return Promise.resolve(this);\n  };\n  /**\n   * Close the {@link Signaling}.\n   * @returns {Promise<this>}\n   */\n\n\n  Signaling.prototype.close = function () {\n    var _this = this;\n\n    return this.bracket('close', function (key) {\n      switch (_this.state) {\n        case 'closed':\n          return _this;\n\n        case 'open':\n          return _this._close(key);\n\n        default:\n          throw new Error(\"Unexpected Signaling state \\\"\" + _this.state + \"\\\"\");\n      }\n    });\n  };\n  /**\n   * Connect to a {@link RoomSignaling}.\n   * @param {ParticipantSignaling} localParticipant\n   * @param {string} token\n   * @param {EncodingParametersImpl} encodingParameters\n   * @param {PreferredCodecs} preferredCodecs\n   * @param {object} options\n   * @returns {Promise<function(): CancelablePromise<RoomSignaling>>}\n   */\n\n\n  Signaling.prototype.connect = function (localParticipant, token, encodingParameters, preferredCodecs, options) {\n    var self = this;\n    return this.bracket('connect', function transition(key) {\n      switch (self.state) {\n        case 'closed':\n          return self._open(key).then(transition.bind(null, key));\n\n        case 'open':\n          // NOTE(mroberts): We don't need to hold the lock in _connect. Instead,\n          // we just need to ensure the Signaling remains open.\n          self.releaseLockCompletely(key);\n          return self._connect(localParticipant, token, encodingParameters, preferredCodecs, options);\n\n        default:\n          throw new Error(\"Unexpected Signaling state \\\"\" + self.state + \"\\\"\");\n      }\n    });\n  };\n  /**\n   * Create a local {@link ParticipantSignaling}.\n   * @returns {ParticipantSignaling}\n   */\n\n\n  Signaling.prototype.createLocalParticipantSignaling = function () {\n    return new ParticipantSignaling();\n  };\n  /**\n   * Open the {@link Signaling}.\n   * @returns {Promise<this>}\n   */\n\n\n  Signaling.prototype.open = function () {\n    var _this = this;\n\n    return this.bracket('open', function (key) {\n      switch (_this.state) {\n        case 'closed':\n          return _this._open(key);\n\n        case 'open':\n          return _this;\n\n        default:\n          throw new Error(\"Unexpected Signaling state \\\"\" + _this.state + \"\\\"\");\n      }\n    });\n  };\n\n  return Signaling;\n}(StateMachine);\n\nmodule.exports = Signaling;","map":{"version":3,"sources":["../../lib/signaling/index.js"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/* eslint consistent-return:0 */\n'use strict';\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar ParticipantSignaling = require('./participant');\nvar RoomSignaling = require('./room');\nvar StateMachine = require('../statemachine');\n/*\nSignaling States\n----------------\n\n              +---------+\n              |         |\n              | opening |\n         +--->|         |\n         |    +---------+\n    +--------+   |   |   +------+\n    |        |<--+   +-->|      |\n    | closed |<----------| open |\n    |        |<--+   +-->|      |\n    +--------+   |   |   +------+\n              +---------+   |\n              |         |<--+\n              | closing |\n              |         |\n              +---------+\n\n*/\nvar states = {\n    closed: [\n        'opening'\n    ],\n    opening: [\n        'closed',\n        'open'\n    ],\n    open: [\n        'closed',\n        'closing'\n    ],\n    closing: [\n        'closed',\n        'open'\n    ]\n};\n/**\n * @extends StateMachine\n * @property {string} state - one of \"closed\", \"opening\", \"open\", or \"closing\"\n */\nvar Signaling = /** @class */ (function (_super) {\n    __extends(Signaling, _super);\n    /**\n     * Construct {@link Signaling}.\n     */\n    function Signaling() {\n        return _super.call(this, 'closed', states) || this;\n    }\n    /**\n     * @private\n     */\n    // NOTE(mroberts): This is a dummy implementation suitable for testing.\n    Signaling.prototype._close = function (key) {\n        this.transition('closing', key);\n        this.transition('closed', key);\n        return Promise.resolve(this);\n    };\n    /**\n     * @private\n     */\n    // NOTE(mroberts): This is a dummy implementation suitable for testing.\n    Signaling.prototype._connect = function (localParticipant, token, encodingParameters, preferredCodecs, options) {\n        localParticipant.connect('PA00000000000000000000000000000000', 'test');\n        var sid = 'RM00000000000000000000000000000000';\n        var promise = Promise.resolve(new RoomSignaling(localParticipant, sid, options));\n        promise.cancel = function cancel() { };\n        return promise;\n    };\n    /**\n     * @private\n     */\n    // NOTE(mroberts): This is a dummy implementation suitable for testing.\n    Signaling.prototype._open = function (key) {\n        this.transition('opening', key);\n        this.transition('open', key);\n        return Promise.resolve(this);\n    };\n    /**\n     * Close the {@link Signaling}.\n     * @returns {Promise<this>}\n     */\n    Signaling.prototype.close = function () {\n        var _this = this;\n        return this.bracket('close', function (key) {\n            switch (_this.state) {\n                case 'closed':\n                    return _this;\n                case 'open':\n                    return _this._close(key);\n                default:\n                    throw new Error(\"Unexpected Signaling state \\\"\" + _this.state + \"\\\"\");\n            }\n        });\n    };\n    /**\n     * Connect to a {@link RoomSignaling}.\n     * @param {ParticipantSignaling} localParticipant\n     * @param {string} token\n     * @param {EncodingParametersImpl} encodingParameters\n     * @param {PreferredCodecs} preferredCodecs\n     * @param {object} options\n     * @returns {Promise<function(): CancelablePromise<RoomSignaling>>}\n     */\n    Signaling.prototype.connect = function (localParticipant, token, encodingParameters, preferredCodecs, options) {\n        var self = this;\n        return this.bracket('connect', function transition(key) {\n            switch (self.state) {\n                case 'closed':\n                    return self._open(key).then(transition.bind(null, key));\n                case 'open':\n                    // NOTE(mroberts): We don't need to hold the lock in _connect. Instead,\n                    // we just need to ensure the Signaling remains open.\n                    self.releaseLockCompletely(key);\n                    return self._connect(localParticipant, token, encodingParameters, preferredCodecs, options);\n                default:\n                    throw new Error(\"Unexpected Signaling state \\\"\" + self.state + \"\\\"\");\n            }\n        });\n    };\n    /**\n     * Create a local {@link ParticipantSignaling}.\n     * @returns {ParticipantSignaling}\n     */\n    Signaling.prototype.createLocalParticipantSignaling = function () {\n        return new ParticipantSignaling();\n    };\n    /**\n     * Open the {@link Signaling}.\n     * @returns {Promise<this>}\n     */\n    Signaling.prototype.open = function () {\n        var _this = this;\n        return this.bracket('open', function (key) {\n            switch (_this.state) {\n                case 'closed':\n                    return _this._open(key);\n                case 'open':\n                    return _this;\n                default:\n                    throw new Error(\"Unexpected Signaling state \\\"\" + _this.state + \"\\\"\");\n            }\n        });\n    };\n    return Signaling;\n}(StateMachine));\nmodule.exports = Signaling;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}