{"ast":null,"code":"/* eslint-disable no-console */\n'use strict';\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar VALID_GROUPS = ['signaling', 'room', 'media', 'quality', 'video-processor'];\nvar VALID_LEVELS = ['debug', 'error', 'info', 'warning'];\n/**\n * EventObserver listens to SDK events and re-emits them on the\n * @link EventListener} with some additional information.\n * @extends EventEmitter\n * @emits EventObserver#event\n */\n\nvar EventObserver = function (_super) {\n  __extends(EventObserver, _super);\n  /**\n   * Constructor.\n   * @param {number} connectTimestamp\n   * @param {Log} log\n   * @param {EventListener} [eventListener]\n   */\n\n\n  function EventObserver(connectTimestamp, log, eventListener) {\n    if (eventListener === void 0) {\n      eventListener = null;\n    }\n\n    var _this = _super.call(this) || this;\n\n    Object.defineProperties(_this, {\n      _publisher: {\n        value: null,\n        writable: true\n      }\n    });\n\n    _this.on('event', function (_a) {\n      var name = _a.name,\n          group = _a.group,\n          level = _a.level,\n          payload = _a.payload;\n\n      if (typeof name !== 'string') {\n        throw new Error('Unexpected name: ', name);\n      }\n\n      if (!VALID_GROUPS.includes(group)) {\n        throw new Error('Unexpected group: ', group);\n      }\n\n      if (!VALID_LEVELS.includes(level)) {\n        throw new Error('Unexpected level: ', level);\n      }\n\n      var timestamp = Date.now();\n      var elapsedTime = timestamp - connectTimestamp;\n\n      if (_this._publisher) {\n        var publisherPayload = Object.assign({\n          elapsedTime: elapsedTime,\n          level: level\n        }, payload ? payload : {});\n\n        _this._publisher.publish(group, name, publisherPayload);\n      }\n\n      var event = Object.assign({\n        elapsedTime: elapsedTime,\n        group: group,\n        level: level,\n        name: name,\n        timestamp: timestamp\n      }, payload ? {\n        payload: payload\n      } : {});\n      var logLevel = {\n        debug: 'debug',\n        error: 'error',\n        info: 'info',\n        warning: 'warn'\n      }[level];\n      log[logLevel]('event', event);\n\n      if (eventListener && group === 'signaling') {\n        eventListener.emit('event', event);\n      }\n    });\n\n    return _this;\n  }\n  /**\n   * sets the publisher object. Once set events will be sent to publisher.\n   * @param {InsightsPublisher} publisher\n  */\n\n\n  EventObserver.prototype.setPublisher = function (publisher) {\n    this._publisher = publisher;\n  };\n\n  return EventObserver;\n}(EventEmitter);\n/**\n * An SDK event.\n * @event EventObserver#event\n * @param {{name: string, payload: *}} event\n */\n\n\nmodule.exports = EventObserver;","map":{"version":3,"sources":["../../lib/util/eventobserver.js"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/* eslint-disable no-console */\n'use strict';\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar EventEmitter = require('events').EventEmitter;\nvar VALID_GROUPS = [\n    'signaling',\n    'room',\n    'media',\n    'quality',\n    'video-processor'\n];\nvar VALID_LEVELS = [\n    'debug',\n    'error',\n    'info',\n    'warning'\n];\n/**\n * EventObserver listens to SDK events and re-emits them on the\n * @link EventListener} with some additional information.\n * @extends EventEmitter\n * @emits EventObserver#event\n */\nvar EventObserver = /** @class */ (function (_super) {\n    __extends(EventObserver, _super);\n    /**\n     * Constructor.\n     * @param {number} connectTimestamp\n     * @param {Log} log\n     * @param {EventListener} [eventListener]\n     */\n    function EventObserver(connectTimestamp, log, eventListener) {\n        if (eventListener === void 0) { eventListener = null; }\n        var _this = _super.call(this) || this;\n        Object.defineProperties(_this, {\n            _publisher: {\n                value: null,\n                writable: true\n            }\n        });\n        _this.on('event', function (_a) {\n            var name = _a.name, group = _a.group, level = _a.level, payload = _a.payload;\n            if (typeof name !== 'string') {\n                throw new Error('Unexpected name: ', name);\n            }\n            if (!VALID_GROUPS.includes(group)) {\n                throw new Error('Unexpected group: ', group);\n            }\n            if (!VALID_LEVELS.includes(level)) {\n                throw new Error('Unexpected level: ', level);\n            }\n            var timestamp = Date.now();\n            var elapsedTime = timestamp - connectTimestamp;\n            if (_this._publisher) {\n                var publisherPayload = Object.assign({ elapsedTime: elapsedTime, level: level }, payload ? payload : {});\n                _this._publisher.publish(group, name, publisherPayload);\n            }\n            var event = Object.assign({\n                elapsedTime: elapsedTime,\n                group: group,\n                level: level,\n                name: name,\n                timestamp: timestamp\n            }, payload ? { payload: payload } : {});\n            var logLevel = {\n                debug: 'debug',\n                error: 'error',\n                info: 'info',\n                warning: 'warn',\n            }[level];\n            log[logLevel]('event', event);\n            if (eventListener && group === 'signaling') {\n                eventListener.emit('event', event);\n            }\n        });\n        return _this;\n    }\n    /**\n     * sets the publisher object. Once set events will be sent to publisher.\n     * @param {InsightsPublisher} publisher\n    */\n    EventObserver.prototype.setPublisher = function (publisher) {\n        this._publisher = publisher;\n    };\n    return EventObserver;\n}(EventEmitter));\n/**\n * An SDK event.\n * @event EventObserver#event\n * @param {{name: string, payload: *}} event\n */\nmodule.exports = EventObserver;\n//# sourceMappingURL=eventobserver.js.map"]},"metadata":{},"sourceType":"script"}