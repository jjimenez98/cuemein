{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getTurnCredentials = void 0;\n\nvar TwilioConnection = require('../twilioconnection.js');\n\nvar _a = require('../util/constants'),\n    WS_SERVER = _a.WS_SERVER,\n    ICE_VERSION = _a.ICE_VERSION;\n\nvar events_1 = require(\"events\");\n\nfunction getTurnCredentials(token, options) {\n  return new Promise(function (resolve, reject) {\n    options = __assign({\n      environment: 'prod',\n      region: 'gll'\n    }, options); // eslint-disable-next-line new-cap\n\n    var wsServer = WS_SERVER(options.environment, options.region);\n    var eventObserver = new events_1.EventEmitter();\n    var connectionOptions = {\n      networkMonitor: null,\n      eventObserver: eventObserver,\n      helloBody: {\n        edge: 'roaming',\n        preflight: true,\n        token: token,\n        type: 'ice',\n        version: ICE_VERSION\n      }\n    };\n    var twilioConnection = new TwilioConnection(wsServer, connectionOptions);\n    var done = false;\n    twilioConnection.once('close', function (reason) {\n      if (!done) {\n        done = true;\n        reject(reason);\n      }\n    }); // eslint-disable-next-line camelcase\n\n    twilioConnection.on('message', function (message) {\n      if (message.type === 'iced') {\n        if (!done) {\n          done = true;\n          resolve(message.ice_servers);\n          twilioConnection.close();\n        }\n      }\n    });\n  });\n}\n\nexports.getTurnCredentials = getTurnCredentials;","map":{"version":3,"sources":["../../lib/preflight/getturncredentials.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAM,gBAAgB,GAAG,OAAO,CAAC,wBAAD,CAAhC;;AACM,IAAA,EAAA,GAA6B,OAAO,CAAC,mBAAD,CAApC;AAAA,IAAE,SAAS,GAAA,EAAA,CAAA,SAAX;AAAA,IAAa,WAAW,GAAA,EAAA,CAAA,WAAxB;;AAGN,IAAA,QAAA,GAAA,OAAA,CAAA,QAAA,CAAA;;AAKA,SAAgB,kBAAhB,CAAmC,KAAnC,EAAkD,OAAlD,EAA2E;AACzE,SAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAgB;AACjC,IAAA,OAAO,GAAA,QAAA,CAAA;AACL,MAAA,WAAW,EAAE,MADR;AAEL,MAAA,MAAM,EAAE;AAFH,KAAA,EAGF,OAHE,CAAP,CADiC,CAOjC;;AACA,QAAM,QAAQ,GAAG,SAAS,CAAC,OAAO,CAAC,WAAT,EAAsB,OAAO,CAAC,MAA9B,CAA1B;AAEA,QAAM,aAAa,GAAG,IAAI,QAAA,CAAA,YAAJ,EAAtB;AACA,QAAM,iBAAiB,GAAG;AACxB,MAAA,cAAc,EAAE,IADQ;AAExB,MAAA,aAAa,EAAA,aAFW;AAGxB,MAAA,SAAS,EAAE;AACT,QAAA,IAAI,EAAE,SADG;AAET,QAAA,SAAS,EAAE,IAFF;AAGT,QAAA,KAAK,EAAE,KAHE;AAIT,QAAA,IAAI,EAAE,KAJG;AAKT,QAAA,OAAO,EAAE;AALA;AAHa,KAA1B;AAYA,QAAM,gBAAgB,GAAG,IAAI,gBAAJ,CAAqB,QAArB,EAA+B,iBAA/B,CAAzB;AACA,QAAI,IAAI,GAAG,KAAX;AACA,IAAA,gBAAgB,CAAC,IAAjB,CAAsB,OAAtB,EAA+B,UAAC,MAAD,EAAe;AAC5C,UAAI,CAAC,IAAL,EAAW;AACT,QAAA,IAAI,GAAG,IAAP;AACA,QAAA,MAAM,CAAC,MAAD,CAAN;AACD;AACF,KALD,EAzBiC,CAgCjC;;AACA,IAAA,gBAAgB,CAAC,EAAjB,CAAoB,SAApB,EAA+B,UAAC,OAAD,EAAwD;AACrF,UAAI,OAAO,CAAC,IAAR,KAAiB,MAArB,EAA6B;AAC3B,YAAI,CAAC,IAAL,EAAW;AACT,UAAA,IAAI,GAAG,IAAP;AACA,UAAA,OAAO,CAAC,OAAO,CAAC,WAAT,CAAP;AACA,UAAA,gBAAgB,CAAC,KAAjB;AACD;AACF;AACF,KARD;AASD,GA1CM,CAAP;AA2CD;;AA5CD,OAAA,CAAA,kBAAA,GAAA,kBAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getTurnCredentials = void 0;\nvar TwilioConnection = require('../twilioconnection.js');\nvar _a = require('../util/constants'), WS_SERVER = _a.WS_SERVER, ICE_VERSION = _a.ICE_VERSION;\nvar events_1 = require(\"events\");\nfunction getTurnCredentials(token, options) {\n    return new Promise(function (resolve, reject) {\n        options = __assign({ environment: 'prod', region: 'gll' }, options);\n        // eslint-disable-next-line new-cap\n        var wsServer = WS_SERVER(options.environment, options.region);\n        var eventObserver = new events_1.EventEmitter();\n        var connectionOptions = {\n            networkMonitor: null,\n            eventObserver: eventObserver,\n            helloBody: {\n                edge: 'roaming',\n                preflight: true,\n                token: token,\n                type: 'ice',\n                version: ICE_VERSION\n            },\n        };\n        var twilioConnection = new TwilioConnection(wsServer, connectionOptions);\n        var done = false;\n        twilioConnection.once('close', function (reason) {\n            if (!done) {\n                done = true;\n                reject(reason);\n            }\n        });\n        // eslint-disable-next-line camelcase\n        twilioConnection.on('message', function (message) {\n            if (message.type === 'iced') {\n                if (!done) {\n                    done = true;\n                    resolve(message.ice_servers);\n                    twilioConnection.close();\n                }\n            }\n        });\n    });\n}\nexports.getTurnCredentials = getTurnCredentials;\n//# sourceMappingURL=getturncredentials.js.map"]},"metadata":{},"sourceType":"script"}