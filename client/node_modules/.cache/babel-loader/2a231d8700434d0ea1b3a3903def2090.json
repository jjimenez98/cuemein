{"ast":null,"code":"'use strict';\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) {\n    to[j] = from[i];\n  }\n\n  return to;\n};\n\nvar constants = require('./constants');\n\nvar E = constants.typeErrors,\n    trackPriority = constants.trackPriority;\n\nvar util = require('@twilio/webrtc/lib/util');\n/**\n * Return the given {@link LocalTrack} or a new {@link LocalTrack} for the\n * given MediaStreamTrack.\n * @param {LocalTrack|MediaStreamTrack} track\n * @param {object} options\n * @returns {LocalTrack}\n * @throws {TypeError}\n */\n\n\nfunction asLocalTrack(track, options) {\n  if (track instanceof options.LocalAudioTrack || track instanceof options.LocalVideoTrack || track instanceof options.LocalDataTrack) {\n    return track;\n  }\n\n  if (track instanceof options.MediaStreamTrack) {\n    return track.kind === 'audio' ? new options.LocalAudioTrack(track, options) : new options.LocalVideoTrack(track, options);\n  }\n  /* eslint new-cap:0 */\n\n\n  throw E.INVALID_TYPE('track', 'LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack');\n}\n/**\n * Create a new {@link LocalTrackPublication} for the given {@link LocalTrack}.\n * @param {LocalTrack} track\n * @param {LocalTrackPublicationSignaling} signaling\n * @param {function(track: LocalTrackPublication): void} unpublish\n * @param {object} options\n */\n\n\nfunction asLocalTrackPublication(track, signaling, unpublish, options) {\n  var LocalTrackPublication = {\n    audio: options.LocalAudioTrackPublication,\n    video: options.LocalVideoTrackPublication,\n    data: options.LocalDataTrackPublication\n  }[track.kind];\n  return new LocalTrackPublication(signaling, track, unpublish, options);\n}\n/**\n * Capitalize a word.\n * @param {string} word\n * @returns {string} capitalized\n */\n\n\nfunction capitalize(word) {\n  return word[0].toUpperCase() + word.slice(1);\n}\n/**\n * Log deprecation warnings for the given events of an EventEmitter.\n * @param {string} name\n * @param {EventEmitter} emitter\n * @param {Map<string, string>} events\n * @param {Log} log\n */\n\n\nfunction deprecateEvents(name, emitter, events, log) {\n  var warningsShown = new Set();\n  emitter.on('newListener', function newListener(event) {\n    if (events.has(event) && !warningsShown.has(event)) {\n      log.deprecated(name + \"#\" + event + \" has been deprecated and scheduled for removal in twilio-video.js@2.0.0.\" + (events.get(event) ? \" Use \" + name + \"#\" + events.get(event) + \" instead.\" : ''));\n      warningsShown.add(event);\n    }\n\n    if (warningsShown.size >= events.size) {\n      emitter.removeListener('newListener', newListener);\n    }\n  });\n}\n/**\n * Finds the items in list1 that are not in list2.\n * @param {Array<*>|Map<*>|Set<*>} list1\n * @param {Array<*>|Map<*>|Set<*>} list2\n * @returns {Set}\n */\n\n\nfunction difference(list1, list2) {\n  list1 = Array.isArray(list1) ? new Set(list1) : new Set(list1.values());\n  list2 = Array.isArray(list2) ? new Set(list2) : new Set(list2.values());\n  var difference = new Set();\n  list1.forEach(function (item) {\n    if (!list2.has(item)) {\n      difference.add(item);\n    }\n  });\n  return difference;\n}\n/**\n * Filter out the keys in an object with a given value.\n * @param {object} object - Object to be filtered\n * @param {*} [filterValue] - Value to be filtered out; If not specified, then\n *   filters out all keys which have an explicit value of \"undefined\"\n * @returns {object} - Filtered object\n */\n\n\nfunction filterObject(object, filterValue) {\n  return Object.keys(object).reduce(function (filtered, key) {\n    if (object[key] !== filterValue) {\n      filtered[key] = object[key];\n    }\n\n    return filtered;\n  }, {});\n}\n/**\n * Map a list to an array of arrays, and return the flattened result.\n * @param {Array<*>|Set<*>|Map<*>} list\n * @param {function(*): Array<*>} [mapFn]\n * @returns Array<*>\n */\n\n\nfunction flatMap(list, mapFn) {\n  var listArray = list instanceof Map || list instanceof Set ? Array.from(list.values()) : list;\n\n  mapFn = mapFn || function mapFn(item) {\n    return item;\n  };\n\n  return listArray.reduce(function (flattened, item) {\n    var mapped = mapFn(item);\n    return flattened.concat(mapped);\n  }, []);\n}\n/**\n * Get the user agent string, or return \"Unknown\".\n * @returns {string}\n */\n\n\nfunction getUserAgent() {\n  return typeof navigator !== 'undefined' && navigator.userAgent ? navigator.userAgent : 'Unknown';\n}\n/**\n * Get the platform component of the user agent string.\n * Example:\n *   Input - Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36\n *   Output - macintosh\n * @returns {string}\n */\n\n\nfunction getPlatform() {\n  var userAgent = getUserAgent();\n\n  var _a = __read(userAgent.match(/\\(([^)]+)\\)/) || [], 2),\n      _b = _a[1],\n      match = _b === void 0 ? 'unknown' : _b;\n\n  var _c = __read(match.split(';').map(function (entry) {\n    return entry.trim();\n  }), 1),\n      platform = _c[0];\n\n  return platform.toLowerCase();\n}\n/**\n * Create a unique identifier.\n * @returns {string}\n */\n\n\nfunction makeUUID() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0;\n    var v = c === 'x' ? r : r & 0x3 | 0x8;\n    return v.toString(16);\n  });\n}\n/**\n * Ensure that the given function is called once per tick.\n * @param {function} fn - Function to be executed\n * @returns {function} - Schedules the given function to be called on the next tick\n */\n\n\nfunction oncePerTick(fn) {\n  var timeout = null;\n\n  function nextTick() {\n    timeout = null;\n    fn();\n  }\n\n  return function scheduleNextTick() {\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n\n    timeout = setTimeout(nextTick);\n  };\n}\n\nfunction promiseFromEvents(operation, eventEmitter, successEvent, failureEvent) {\n  return new Promise(function (resolve, reject) {\n    function onSuccess() {\n      var args = [].slice.call(arguments);\n\n      if (failureEvent) {\n        eventEmitter.removeListener(failureEvent, onFailure);\n      }\n\n      resolve.apply(void 0, __spreadArray([], __read(args)));\n    }\n\n    function onFailure() {\n      var args = [].slice.call(arguments);\n      eventEmitter.removeListener(successEvent, onSuccess);\n      reject.apply(void 0, __spreadArray([], __read(args)));\n    }\n\n    eventEmitter.once(successEvent, onSuccess);\n\n    if (failureEvent) {\n      eventEmitter.once(failureEvent, onFailure);\n    }\n\n    operation();\n  });\n}\n/**\n * Traverse down multiple nodes on an object and return null if\n * any link in the path is unavailable.\n * @param {Object} obj - Object to traverse\n * @param {String} path - Path to traverse. Period-separated.\n * @returns {Any|null}\n */\n\n\nfunction getOrNull(obj, path) {\n  return path.split('.').reduce(function (output, step) {\n    if (!output) {\n      return null;\n    }\n\n    return output[step];\n  }, obj);\n}\n/**\n * @typedef {object} Deferred\n * @property {Promise} promise\n * @property {function} reject\n * @property {function} resolve\n */\n\n/**\n * Create a {@link Deferred}.\n * @returns {Deferred}\n */\n\n\nfunction defer() {\n  var deferred = {};\n  deferred.promise = new Promise(function (resolve, reject) {\n    deferred.resolve = resolve;\n    deferred.reject = reject;\n  });\n  return deferred;\n}\n/**\n * Copy a method from a `source` prototype onto a `wrapper` prototype. Invoking\n * the method on the `wrapper` prototype will invoke the corresponding method\n * on an instance accessed by `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @param {string} methodName\n * @returns {undefined}\n */\n\n\nfunction delegateMethod(source, wrapper, target, methodName) {\n  if (methodName in wrapper) {\n    // Skip any methods already set.\n    return;\n  } else if (methodName.match(/^on[a-z]+$/)) {\n    // Skip EventHandlers (these are handled in the constructor).\n    return;\n  }\n\n  var type;\n\n  try {\n    type = typeof source[methodName];\n  } catch (error) {// NOTE(mroberts): Attempting to check the type of non-function members\n    // on the prototype throws an error for some types.\n  }\n\n  if (type !== 'function') {\n    // Skip non-function members.\n    return;\n  }\n  /* eslint no-loop-func:0 */\n\n\n  wrapper[methodName] = function () {\n    var _a;\n\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return (_a = this[target])[methodName].apply(_a, __spreadArray([], __read(args)));\n  };\n}\n/**\n * Copy methods from a `source` prototype onto a `wrapper` prototype. Invoking\n * the methods on the `wrapper` prototype will invoke the corresponding method\n * on an instance accessed by `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @returns {undefined}\n */\n\n\nfunction delegateMethods(source, wrapper, target) {\n  for (var methodName in source) {\n    delegateMethod(source, wrapper, target, methodName);\n  }\n}\n/**\n * Determine whether two values are deeply equal.\n * @param {*} val1\n * @param {*} val2\n * @returns {boolean}\n */\n\n\nfunction isDeepEqual(val1, val2) {\n  if (val1 === val2) {\n    return true;\n  }\n\n  if (typeof val1 !== typeof val2) {\n    return false;\n  }\n\n  if (val1 === null) {\n    return val2 === null;\n  }\n\n  if (val2 === null) {\n    return false;\n  }\n\n  if (Array.isArray(val1)) {\n    return Array.isArray(val2) && val1.length === val2.length && val1.every(function (val, i) {\n      return isDeepEqual(val, val2[i]);\n    });\n  }\n\n  if (typeof val1 === 'object') {\n    var val1Keys = Object.keys(val1).sort();\n    var val2Keys = Object.keys(val2).sort();\n    return !Array.isArray(val2) && isDeepEqual(val1Keys, val2Keys) && val1Keys.every(function (key) {\n      return isDeepEqual(val1[key], val2[key]);\n    });\n  }\n\n  return false;\n}\n/**\n * Whether the given argument is a non-array object.\n * @param {*} object\n * @return {boolean}\n */\n\n\nfunction isNonArrayObject(object) {\n  return typeof object === 'object' && !Array.isArray(object);\n}\n/**\n * For each property name on the `source` prototype, add getters and/or setters\n * to `wrapper` that proxy to `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @returns {undefined}\n */\n\n\nfunction proxyProperties(source, wrapper, target) {\n  Object.getOwnPropertyNames(source).forEach(function (propertyName) {\n    proxyProperty(source, wrapper, target, propertyName);\n  });\n}\n/**\n * For the property name on the `source` prototype, add a getter and/or setter\n * to `wrapper` that proxies to `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @param {string} propertyName\n * @returns {undefined}\n */\n\n\nfunction proxyProperty(source, wrapper, target, propertyName) {\n  if (propertyName in wrapper) {\n    // Skip any properties already set.\n    return;\n  } else if (propertyName.match(/^on[a-z]+$/)) {\n    Object.defineProperty(wrapper, propertyName, {\n      value: null,\n      writable: true\n    });\n    target.addEventListener(propertyName.slice(2), function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      wrapper.dispatchEvent.apply(wrapper, __spreadArray([], __read(args)));\n    });\n    return;\n  }\n\n  Object.defineProperty(wrapper, propertyName, {\n    enumerable: true,\n    get: function get() {\n      return target[propertyName];\n    }\n  });\n}\n/**\n * This is a function for turning a Promise into the kind referenced in the\n * Legacy Interface Extensions section of the WebRTC spec.\n * @param {Promise<*>} promise\n * @param {function<*>} onSuccess\n * @param {function<Error>} onFailure\n * @returns {Promise<undefined>}\n */\n\n\nfunction legacyPromise(promise, onSuccess, onFailure) {\n  if (onSuccess) {\n    return promise.then(function (result) {\n      onSuccess(result);\n    }, function (error) {\n      onFailure(error);\n    });\n  }\n\n  return promise;\n}\n/**\n * Build the {@link LogLevels} object.\n * @param {String|LogLevel} logLevel - Log level name or object\n * @returns {LogLevels}\n */\n\n\nfunction buildLogLevels(logLevel) {\n  if (typeof logLevel === 'string') {\n    return {\n      default: logLevel,\n      media: logLevel,\n      signaling: logLevel,\n      webrtc: logLevel\n    };\n  }\n\n  return logLevel;\n}\n/**\n * Get the {@link Track}'s derived class name\n * @param {Track} track\n * @param {?boolean} [local=undefined]\n * @returns {string}\n */\n\n\nfunction trackClass(track, local) {\n  local = local ? 'Local' : '';\n  return local + (track.kind || '').replace(/\\w{1}/, function (m) {\n    return m.toUpperCase();\n  }) + \"Track\";\n}\n/**\n * Get the {@link TrackPublication}'s derived class name\n * @param {TrackPublication} publication\n * @param {?boolean} [local=undefined]\n * @returns {string}\n */\n\n\nfunction trackPublicationClass(publication, local) {\n  local = local ? 'Local' : '';\n  return local + (publication.kind || '').replace(/\\w{1}/, function (m) {\n    return m.toUpperCase();\n  }) + \"TrackPublication\";\n}\n/**\n * Sets all underscore-prefixed properties on `object` non-enumerable.\n * @param {Object} object\n * @returns {void}\n */\n\n\nfunction hidePrivateProperties(object) {\n  Object.getOwnPropertyNames(object).forEach(function (name) {\n    if (name.startsWith('_')) {\n      hideProperty(object, name);\n    }\n  });\n}\n/**\n * Creates a new subclass which, in the constructor, sets all underscore-prefixed\n * properties and the given public properties non-enumerable. This is useful for\n * patching up classes like EventEmitter which may set properties like `_events`\n * and `domain`.\n * @param {Function} klass\n * @param {Array<string>} props\n * @returns {Function} subclass\n */\n\n\nfunction hidePrivateAndCertainPublicPropertiesInClass(klass, props) {\n  // NOTE(mroberts): We do this to avoid giving the class a name.\n  return function (_super) {\n    __extends(class_1, _super);\n\n    function class_1() {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var _this = _super.apply(this, __spreadArray([], __read(args))) || this;\n\n      hidePrivateProperties(_this);\n      hidePublicProperties(_this, props);\n      return _this;\n    }\n\n    return class_1;\n  }(klass);\n}\n/**\n * Hide a property of an object.\n * @param {object} object\n * @param {string} name\n */\n\n\nfunction hideProperty(object, name) {\n  var descriptor = Object.getOwnPropertyDescriptor(object, name);\n  descriptor.enumerable = false;\n  Object.defineProperty(object, name, descriptor);\n}\n/**\n * Hide the given public properties of an object.\n * @param {object} object\n * @param {Array<string>} [props=[]]\n */\n\n\nfunction hidePublicProperties(object, props) {\n  if (props === void 0) {\n    props = [];\n  }\n\n  props.forEach(function (name) {\n    // eslint-disable-next-line no-prototype-builtins\n    if (object.hasOwnProperty(name)) {\n      hideProperty(object, name);\n    }\n  });\n}\n/**\n * Convert an Array of values to an Array of JSON values by calling\n * `valueToJSON` on each value.\n * @param {Array<*>} array\n * @returns {Array<*>}\n */\n\n\nfunction arrayToJSON(array) {\n  return array.map(valueToJSON);\n}\n/**\n * Convert a Set of values to an Array of JSON values by calling `valueToJSON`\n * on each value.\n * @param {Set<*>} set\n * @returns {Array<*>}\n */\n\n\nfunction setToJSON(set) {\n  return arrayToJSON(__spreadArray([], __read(set)));\n}\n/**\n * Convert a Map from strings to values to an object of JSON values by calling\n * `valueToJSON` on each value.\n * @param {Map<string, *>} map\n * @returns {object}\n */\n\n\nfunction mapToJSON(map) {\n  return __spreadArray([], __read(map.entries())).reduce(function (json, _a) {\n    var _b;\n\n    var _c = __read(_a, 2),\n        key = _c[0],\n        value = _c[1];\n\n    return Object.assign((_b = {}, _b[key] = valueToJSON(value), _b), json);\n  }, {});\n}\n/**\n * Convert an object to a JSON value by calling `valueToJSON` on its enumerable\n * keys.\n * @param {object} object\n * @returns {object}\n */\n\n\nfunction objectToJSON(object) {\n  return Object.entries(object).reduce(function (json, _a) {\n    var _b;\n\n    var _c = __read(_a, 2),\n        key = _c[0],\n        value = _c[1];\n\n    return Object.assign((_b = {}, _b[key] = valueToJSON(value), _b), json);\n  }, {});\n}\n/**\n * Convert a value into a JSON value.\n * @param {*} value\n * @returns {*}\n */\n\n\nfunction valueToJSON(value) {\n  if (Array.isArray(value)) {\n    return arrayToJSON(value);\n  } else if (value instanceof Set) {\n    return setToJSON(value);\n  } else if (value instanceof Map) {\n    return mapToJSON(value);\n  } else if (value && typeof value === 'object') {\n    return objectToJSON(value);\n  }\n\n  return value;\n}\n\nfunction createRoomConnectEventPayload(connectOptions) {\n  function boolToString(val) {\n    return val ? 'true' : 'false';\n  }\n\n  var payload = {\n    // arrays props converted to lengths.\n    iceServers: (connectOptions.iceServers || []).length,\n    audioTracks: (connectOptions.tracks || []).filter(function (track) {\n      return track.kind === 'audio';\n    }).length,\n    videoTracks: (connectOptions.tracks || []).filter(function (track) {\n      return track.kind === 'video';\n    }).length,\n    dataTracks: (connectOptions.tracks || []).filter(function (track) {\n      return track.kind === 'data';\n    }).length\n  }; // boolean properties.\n\n  [['audio'], ['automaticSubscription'], ['enableDscp'], ['eventListener'], ['preflight'], ['video'], ['dominantSpeaker', 'enableDominantSpeaker']].forEach(function (_a) {\n    var _b = __read(_a, 2),\n        prop = _b[0],\n        eventProp = _b[1];\n\n    eventProp = eventProp || prop;\n    payload[eventProp] = boolToString(!!connectOptions[prop]);\n  }); // numbers and string properties.\n\n  [['maxVideoBitrate'], ['maxAudioBitrate'], ['iceTransportPolicy'], ['region'], ['name', 'roomName']].forEach(function (_a) {\n    var _b = __read(_a, 2),\n        prop = _b[0],\n        eventProp = _b[1];\n\n    eventProp = eventProp || prop;\n\n    if (typeof connectOptions[prop] === 'number' || typeof connectOptions[prop] === 'string') {\n      payload[eventProp] = connectOptions[prop];\n    }\n  }); // array props stringified.\n\n  ['preferredAudioCodecs', 'preferredVideoCodecs'].forEach(function (prop) {\n    if (prop in connectOptions) {\n      payload[prop] = JSON.stringify(connectOptions[prop]);\n    }\n  });\n\n  if ('networkQuality' in connectOptions) {\n    payload.networkQualityConfiguration = {};\n\n    if (isNonArrayObject(connectOptions.networkQuality)) {\n      ['local', 'remote'].forEach(function (prop) {\n        if (typeof connectOptions.networkQuality[prop] === 'number') {\n          payload.networkQualityConfiguration[prop] = connectOptions.networkQuality[prop];\n        }\n      });\n    } else {\n      payload.networkQualityConfiguration.remote = 0;\n      payload.networkQualityConfiguration.local = connectOptions.networkQuality ? 1 : 0;\n    }\n  }\n\n  if (connectOptions.bandwidthProfile && connectOptions.bandwidthProfile.video) {\n    var videoBPOptions_1 = connectOptions.bandwidthProfile.video || {};\n    payload.bandwidthProfileOptions = {};\n    ['mode', 'maxTracks', 'trackSwitchOffMode', 'dominantSpeakerPriority', 'maxSubscriptionBitrate', 'renderDimensions', 'contentPreferencesMode', 'clientTrackSwitchOffControl'].forEach(function (prop) {\n      if (typeof videoBPOptions_1[prop] === 'number' || typeof videoBPOptions_1[prop] === 'string') {\n        payload.bandwidthProfileOptions[prop] = videoBPOptions_1[prop];\n      } else if (typeof videoBPOptions_1[prop] === 'boolean') {\n        payload.bandwidthProfileOptions[prop] = boolToString(videoBPOptions_1[prop]);\n      } else if (typeof videoBPOptions_1[prop] === 'object') {\n        payload.bandwidthProfileOptions[prop] = JSON.stringify(videoBPOptions_1[prop]);\n      }\n    });\n  }\n\n  return {\n    group: 'room',\n    name: 'connect',\n    level: 'info',\n    payload: payload\n  };\n}\n/**\n * Create the bandwidth profile payload included in an RSP connect message.\n * @param {BandwidthProfileOptions} bandwidthProfile\n * @returns {object}\n */\n\n\nfunction createBandwidthProfilePayload(bandwidthProfile) {\n  return createRSPPayload(bandwidthProfile, [{\n    prop: 'video',\n    type: 'object',\n    transform: createBandwidthProfileVideoPayload\n  }]);\n}\n/**\n * Create the bandwidth profile video payload included in an RSP connect message.\n * @param {VideoBandwidthProfileOptions} bandwidthProfileVideo\n * @returns {object}\n */\n\n\nfunction createBandwidthProfileVideoPayload(bandwidthProfileVideo) {\n  return createRSPPayload(bandwidthProfileVideo, [{\n    prop: 'dominantSpeakerPriority',\n    type: 'string',\n    payloadProp: 'active_speaker_priority'\n  }, {\n    prop: 'maxSubscriptionBitrate',\n    type: 'number',\n    payloadProp: 'max_subscription_bandwidth'\n  }, {\n    prop: 'maxTracks',\n    type: 'number',\n    payloadProp: 'max_tracks'\n  }, {\n    prop: 'mode',\n    type: 'string'\n  }, {\n    prop: 'renderDimensions',\n    type: 'object',\n    payloadProp: 'render_dimensions',\n    transform: createRenderDimensionsPayload\n  }, {\n    prop: 'trackSwitchOffMode',\n    type: 'string',\n    payloadProp: 'track_switch_off'\n  }]);\n}\n/**\n * Create the Media Signaling payload included in an RSP connect message.\n * @param {boolean} dominantSpeaker - whether to enable the Dominant Speaker\n *   protocol or not\n * @param {boolean} networkQuality - whether to enable the Network Quality\n *   protocol or not\n * @param {boolean} trackPriority - whether to enable the Track Priority\n *   protocol or not\n * @param {boolean} trackSwitchOff - whether to enable the Track Switch-Off\n *   protocol or not.\n * @param {boolean} renderHints - whether to enable the renderHints\n *   protocol or not.\n * @returns {object}\n */\n\n\nfunction createMediaSignalingPayload(dominantSpeaker, networkQuality, trackPriority, trackSwitchOff, renderHints) {\n  var transports = {\n    transports: [{\n      type: 'data-channel'\n    }]\n  };\n  return Object.assign(dominantSpeaker // eslint-disable-next-line\n  ? {\n    active_speaker: transports\n  } : {}, networkQuality // eslint-disable-next-line\n  ? {\n    network_quality: transports\n  } : {}, renderHints // eslint-disable-next-line\n  ? {\n    render_hints: transports\n  } : {}, trackPriority // eslint-disable-next-line\n  ? {\n    track_priority: transports\n  } : {}, trackSwitchOff // eslint-disable-next-line\n  ? {\n    track_switch_off: transports\n  } : {});\n}\n/**\n * Create {@link VideoTrack.Dimensions} RSP payload.\n * @param {VideoTrack.Dimensions} [dimensions]\n * @returns {object}\n */\n\n\nfunction createDimensionsPayload(dimensions) {\n  return createRSPPayload(dimensions, [{\n    prop: 'height',\n    type: 'number'\n  }, {\n    prop: 'width',\n    type: 'number'\n  }]);\n}\n/**\n * Create {@link VideoRenderDimensions} RSP payload.\n * @param renderDimensions\n * @returns {object}\n */\n\n\nfunction createRenderDimensionsPayload(renderDimensions) {\n  var PRIORITY_HIGH = trackPriority.PRIORITY_HIGH,\n      PRIORITY_LOW = trackPriority.PRIORITY_LOW,\n      PRIORITY_STANDARD = trackPriority.PRIORITY_STANDARD;\n  return createRSPPayload(renderDimensions, [{\n    prop: PRIORITY_HIGH,\n    type: 'object',\n    transform: createDimensionsPayload\n  }, {\n    prop: PRIORITY_LOW,\n    type: 'object',\n    transform: createDimensionsPayload\n  }, {\n    prop: PRIORITY_STANDARD,\n    type: 'object',\n    transform: createDimensionsPayload\n  }]);\n}\n/**\n * Create an RSP payload for the given object.\n * @param {object} object - object for which RSP payload is to be generated\n * @param {Array<object>} propConversions - conversion rules for object properties;\n *   they specify how object properties should be converted to their corresponding\n *   RSP payload properties\n * @returns {object}\n */\n\n\nfunction createRSPPayload(object, propConversions) {\n  return propConversions.reduce(function (payload, _a) {\n    var _b;\n\n    var prop = _a.prop,\n        type = _a.type,\n        _c = _a.payloadProp,\n        payloadProp = _c === void 0 ? prop : _c,\n        _d = _a.transform,\n        transform = _d === void 0 ? function (x) {\n      return x;\n    } : _d;\n    return typeof object[prop] === type ? Object.assign((_b = {}, _b[payloadProp] = transform(object[prop]), _b), payload) : payload;\n  }, {});\n}\n/**\n * Create the subscribe payload included in an RSP connect/update message.\n * @param {boolean} automaticSubscription - whether to subscribe to all RemoteTracks\n * @returns {object}\n */\n\n\nfunction createSubscribePayload(automaticSubscription) {\n  return {\n    rules: [{\n      type: automaticSubscription ? 'include' : 'exclude',\n      all: true\n    }],\n    revision: 1\n  };\n}\n/**\n * Add random jitter to a given value in the range [-jitter, jitter].\n * @private\n * @param {number} value\n * @param {number} jitter\n * @returns {number} value + random(-jitter, +jitter)\n */\n\n\nfunction withJitter(value, jitter) {\n  var rand = Math.random();\n  return value - jitter + Math.floor(2 * jitter * rand + 0.5);\n}\n/**\n * Checks if the a number is in the range [min, max].\n * @private\n * @param {num} num\n * @param {number} min\n * @param {number} max\n * @return {boolean}\n */\n\n\nfunction inRange(num, min, max) {\n  return min <= num && num <= max;\n}\n/**\n * returns true if given MediaStreamTrack is a screen share track\n * @private\n * @param {MediaStreamTrack} track\n * @returns {boolean}\n */\n\n\nfunction isChromeScreenShareTrack(track) {\n  // NOTE(mpatwardhan): Chrome creates screen share tracks with label like: \"screen:69734272*\"\n  // we will check for label that starts with \"screen:D\" where D being a digit.\n  var isChrome = util.guessBrowser() === 'chrome';\n  return isChrome && track.kind === 'video' && track.label && (/^screen:[0-9]+/.test(track.label) || /^web-contents-media-stream:[0-9/]+/.test(track.label) || /^window:[0-9]+/.test(track.label));\n}\n/**\n * returns true if given MediaStreamTrack is a user media track\n * @private\n * @param {MediaStreamTrack} track\n * @returns {boolean}\n */\n\n\nfunction isUserMediaTrack(track) {\n  // NOTE(mpatwardhan): tracks obtained from getUserMedia have a deviceId in its settings.\n  return typeof track.getSettings().deviceId === 'string';\n}\n/**\n * Returns a promise that resolve after timeoutMS have passed.\n * @param {number} timeoutMS - time to wait in milliseconds.\n * @returns {Promise<void>}\n */\n\n\nfunction waitForSometime(timeoutMS) {\n  if (timeoutMS === void 0) {\n    timeoutMS = 10;\n  }\n\n  return new Promise(function (resolve) {\n    return setTimeout(resolve, timeoutMS);\n  });\n}\n/**\n * Returns a promise that resolve after event is received\n * @returns {Promise<void>}\n */\n\n\nfunction waitForEvent(eventTarget, event) {\n  return new Promise(function (resolve) {\n    eventTarget.addEventListener(event, function onevent(e) {\n      eventTarget.removeEventListener(event, onevent);\n      resolve(e);\n    });\n  });\n}\n\nexports.constants = constants;\nexports.createBandwidthProfilePayload = createBandwidthProfilePayload;\nexports.createMediaSignalingPayload = createMediaSignalingPayload;\nexports.createRoomConnectEventPayload = createRoomConnectEventPayload;\nexports.createSubscribePayload = createSubscribePayload;\nexports.asLocalTrack = asLocalTrack;\nexports.asLocalTrackPublication = asLocalTrackPublication;\nexports.capitalize = capitalize;\nexports.deprecateEvents = deprecateEvents;\nexports.difference = difference;\nexports.filterObject = filterObject;\nexports.flatMap = flatMap;\nexports.getPlatform = getPlatform;\nexports.getUserAgent = getUserAgent;\nexports.hidePrivateProperties = hidePrivateProperties;\nexports.hidePrivateAndCertainPublicPropertiesInClass = hidePrivateAndCertainPublicPropertiesInClass;\nexports.isDeepEqual = isDeepEqual;\nexports.isNonArrayObject = isNonArrayObject;\nexports.inRange = inRange;\nexports.makeUUID = makeUUID;\nexports.oncePerTick = oncePerTick;\nexports.promiseFromEvents = promiseFromEvents;\nexports.getOrNull = getOrNull;\nexports.defer = defer;\nexports.delegateMethods = delegateMethods;\nexports.proxyProperties = proxyProperties;\nexports.legacyPromise = legacyPromise;\nexports.buildLogLevels = buildLogLevels;\nexports.trackClass = trackClass;\nexports.trackPublicationClass = trackPublicationClass;\nexports.valueToJSON = valueToJSON;\nexports.withJitter = withJitter;\nexports.isChromeScreenShareTrack = isChromeScreenShareTrack;\nexports.isUserMediaTrack = isUserMediaTrack;\nexports.waitForSometime = waitForSometime;\nexports.waitForEvent = waitForEvent;","map":{"version":3,"sources":["../../lib/util/index.js"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["'use strict';\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\nvar constants = require('./constants');\nvar E = constants.typeErrors, trackPriority = constants.trackPriority;\nvar util = require('@twilio/webrtc/lib/util');\n/**\n * Return the given {@link LocalTrack} or a new {@link LocalTrack} for the\n * given MediaStreamTrack.\n * @param {LocalTrack|MediaStreamTrack} track\n * @param {object} options\n * @returns {LocalTrack}\n * @throws {TypeError}\n */\nfunction asLocalTrack(track, options) {\n    if (track instanceof options.LocalAudioTrack\n        || track instanceof options.LocalVideoTrack\n        || track instanceof options.LocalDataTrack) {\n        return track;\n    }\n    if (track instanceof options.MediaStreamTrack) {\n        return track.kind === 'audio'\n            ? new options.LocalAudioTrack(track, options)\n            : new options.LocalVideoTrack(track, options);\n    }\n    /* eslint new-cap:0 */\n    throw E.INVALID_TYPE('track', 'LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack');\n}\n/**\n * Create a new {@link LocalTrackPublication} for the given {@link LocalTrack}.\n * @param {LocalTrack} track\n * @param {LocalTrackPublicationSignaling} signaling\n * @param {function(track: LocalTrackPublication): void} unpublish\n * @param {object} options\n */\nfunction asLocalTrackPublication(track, signaling, unpublish, options) {\n    var LocalTrackPublication = {\n        audio: options.LocalAudioTrackPublication,\n        video: options.LocalVideoTrackPublication,\n        data: options.LocalDataTrackPublication\n    }[track.kind];\n    return new LocalTrackPublication(signaling, track, unpublish, options);\n}\n/**\n * Capitalize a word.\n * @param {string} word\n * @returns {string} capitalized\n */\nfunction capitalize(word) {\n    return word[0].toUpperCase() + word.slice(1);\n}\n/**\n * Log deprecation warnings for the given events of an EventEmitter.\n * @param {string} name\n * @param {EventEmitter} emitter\n * @param {Map<string, string>} events\n * @param {Log} log\n */\nfunction deprecateEvents(name, emitter, events, log) {\n    var warningsShown = new Set();\n    emitter.on('newListener', function newListener(event) {\n        if (events.has(event) && !warningsShown.has(event)) {\n            log.deprecated(name + \"#\" + event + \" has been deprecated and scheduled for removal in twilio-video.js@2.0.0.\" + (events.get(event)\n                ? \" Use \" + name + \"#\" + events.get(event) + \" instead.\"\n                : ''));\n            warningsShown.add(event);\n        }\n        if (warningsShown.size >= events.size) {\n            emitter.removeListener('newListener', newListener);\n        }\n    });\n}\n/**\n * Finds the items in list1 that are not in list2.\n * @param {Array<*>|Map<*>|Set<*>} list1\n * @param {Array<*>|Map<*>|Set<*>} list2\n * @returns {Set}\n */\nfunction difference(list1, list2) {\n    list1 = Array.isArray(list1) ? new Set(list1) : new Set(list1.values());\n    list2 = Array.isArray(list2) ? new Set(list2) : new Set(list2.values());\n    var difference = new Set();\n    list1.forEach(function (item) {\n        if (!list2.has(item)) {\n            difference.add(item);\n        }\n    });\n    return difference;\n}\n/**\n * Filter out the keys in an object with a given value.\n * @param {object} object - Object to be filtered\n * @param {*} [filterValue] - Value to be filtered out; If not specified, then\n *   filters out all keys which have an explicit value of \"undefined\"\n * @returns {object} - Filtered object\n */\nfunction filterObject(object, filterValue) {\n    return Object.keys(object).reduce(function (filtered, key) {\n        if (object[key] !== filterValue) {\n            filtered[key] = object[key];\n        }\n        return filtered;\n    }, {});\n}\n/**\n * Map a list to an array of arrays, and return the flattened result.\n * @param {Array<*>|Set<*>|Map<*>} list\n * @param {function(*): Array<*>} [mapFn]\n * @returns Array<*>\n */\nfunction flatMap(list, mapFn) {\n    var listArray = list instanceof Map || list instanceof Set\n        ? Array.from(list.values())\n        : list;\n    mapFn = mapFn || function mapFn(item) {\n        return item;\n    };\n    return listArray.reduce(function (flattened, item) {\n        var mapped = mapFn(item);\n        return flattened.concat(mapped);\n    }, []);\n}\n/**\n * Get the user agent string, or return \"Unknown\".\n * @returns {string}\n */\nfunction getUserAgent() {\n    return typeof navigator !== 'undefined' && navigator.userAgent\n        ? navigator.userAgent\n        : 'Unknown';\n}\n/**\n * Get the platform component of the user agent string.\n * Example:\n *   Input - Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36\n *   Output - macintosh\n * @returns {string}\n */\nfunction getPlatform() {\n    var userAgent = getUserAgent();\n    var _a = __read(userAgent.match(/\\(([^)]+)\\)/) || [], 2), _b = _a[1], match = _b === void 0 ? 'unknown' : _b;\n    var _c = __read(match.split(';').map(function (entry) { return entry.trim(); }), 1), platform = _c[0];\n    return platform.toLowerCase();\n}\n/**\n * Create a unique identifier.\n * @returns {string}\n */\nfunction makeUUID() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n        var r = Math.random() * 16 | 0;\n        var v = c === 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\n/**\n * Ensure that the given function is called once per tick.\n * @param {function} fn - Function to be executed\n * @returns {function} - Schedules the given function to be called on the next tick\n */\nfunction oncePerTick(fn) {\n    var timeout = null;\n    function nextTick() {\n        timeout = null;\n        fn();\n    }\n    return function scheduleNextTick() {\n        if (timeout) {\n            clearTimeout(timeout);\n        }\n        timeout = setTimeout(nextTick);\n    };\n}\nfunction promiseFromEvents(operation, eventEmitter, successEvent, failureEvent) {\n    return new Promise(function (resolve, reject) {\n        function onSuccess() {\n            var args = [].slice.call(arguments);\n            if (failureEvent) {\n                eventEmitter.removeListener(failureEvent, onFailure);\n            }\n            resolve.apply(void 0, __spreadArray([], __read(args)));\n        }\n        function onFailure() {\n            var args = [].slice.call(arguments);\n            eventEmitter.removeListener(successEvent, onSuccess);\n            reject.apply(void 0, __spreadArray([], __read(args)));\n        }\n        eventEmitter.once(successEvent, onSuccess);\n        if (failureEvent) {\n            eventEmitter.once(failureEvent, onFailure);\n        }\n        operation();\n    });\n}\n/**\n * Traverse down multiple nodes on an object and return null if\n * any link in the path is unavailable.\n * @param {Object} obj - Object to traverse\n * @param {String} path - Path to traverse. Period-separated.\n * @returns {Any|null}\n */\nfunction getOrNull(obj, path) {\n    return path.split('.').reduce(function (output, step) {\n        if (!output) {\n            return null;\n        }\n        return output[step];\n    }, obj);\n}\n/**\n * @typedef {object} Deferred\n * @property {Promise} promise\n * @property {function} reject\n * @property {function} resolve\n */\n/**\n * Create a {@link Deferred}.\n * @returns {Deferred}\n */\nfunction defer() {\n    var deferred = {};\n    deferred.promise = new Promise(function (resolve, reject) {\n        deferred.resolve = resolve;\n        deferred.reject = reject;\n    });\n    return deferred;\n}\n/**\n * Copy a method from a `source` prototype onto a `wrapper` prototype. Invoking\n * the method on the `wrapper` prototype will invoke the corresponding method\n * on an instance accessed by `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @param {string} methodName\n * @returns {undefined}\n */\nfunction delegateMethod(source, wrapper, target, methodName) {\n    if (methodName in wrapper) {\n        // Skip any methods already set.\n        return;\n    }\n    else if (methodName.match(/^on[a-z]+$/)) {\n        // Skip EventHandlers (these are handled in the constructor).\n        return;\n    }\n    var type;\n    try {\n        type = typeof source[methodName];\n    }\n    catch (error) {\n        // NOTE(mroberts): Attempting to check the type of non-function members\n        // on the prototype throws an error for some types.\n    }\n    if (type !== 'function') {\n        // Skip non-function members.\n        return;\n    }\n    /* eslint no-loop-func:0 */\n    wrapper[methodName] = function () {\n        var _a;\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return (_a = this[target])[methodName].apply(_a, __spreadArray([], __read(args)));\n    };\n}\n/**\n * Copy methods from a `source` prototype onto a `wrapper` prototype. Invoking\n * the methods on the `wrapper` prototype will invoke the corresponding method\n * on an instance accessed by `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @returns {undefined}\n */\nfunction delegateMethods(source, wrapper, target) {\n    for (var methodName in source) {\n        delegateMethod(source, wrapper, target, methodName);\n    }\n}\n/**\n * Determine whether two values are deeply equal.\n * @param {*} val1\n * @param {*} val2\n * @returns {boolean}\n */\nfunction isDeepEqual(val1, val2) {\n    if (val1 === val2) {\n        return true;\n    }\n    if (typeof val1 !== typeof val2) {\n        return false;\n    }\n    if (val1 === null) {\n        return val2 === null;\n    }\n    if (val2 === null) {\n        return false;\n    }\n    if (Array.isArray(val1)) {\n        return Array.isArray(val2)\n            && val1.length === val2.length\n            && val1.every(function (val, i) { return isDeepEqual(val, val2[i]); });\n    }\n    if (typeof val1 === 'object') {\n        var val1Keys = Object.keys(val1).sort();\n        var val2Keys = Object.keys(val2).sort();\n        return !Array.isArray(val2)\n            && isDeepEqual(val1Keys, val2Keys)\n            && val1Keys.every(function (key) { return isDeepEqual(val1[key], val2[key]); });\n    }\n    return false;\n}\n/**\n * Whether the given argument is a non-array object.\n * @param {*} object\n * @return {boolean}\n */\nfunction isNonArrayObject(object) {\n    return typeof object === 'object' && !Array.isArray(object);\n}\n/**\n * For each property name on the `source` prototype, add getters and/or setters\n * to `wrapper` that proxy to `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @returns {undefined}\n */\nfunction proxyProperties(source, wrapper, target) {\n    Object.getOwnPropertyNames(source).forEach(function (propertyName) {\n        proxyProperty(source, wrapper, target, propertyName);\n    });\n}\n/**\n * For the property name on the `source` prototype, add a getter and/or setter\n * to `wrapper` that proxies to `target`.\n * @param {object} source\n * @param {object} wrapper\n * @param {string} target\n * @param {string} propertyName\n * @returns {undefined}\n */\nfunction proxyProperty(source, wrapper, target, propertyName) {\n    if (propertyName in wrapper) {\n        // Skip any properties already set.\n        return;\n    }\n    else if (propertyName.match(/^on[a-z]+$/)) {\n        Object.defineProperty(wrapper, propertyName, {\n            value: null,\n            writable: true\n        });\n        target.addEventListener(propertyName.slice(2), function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            wrapper.dispatchEvent.apply(wrapper, __spreadArray([], __read(args)));\n        });\n        return;\n    }\n    Object.defineProperty(wrapper, propertyName, {\n        enumerable: true,\n        get: function () {\n            return target[propertyName];\n        }\n    });\n}\n/**\n * This is a function for turning a Promise into the kind referenced in the\n * Legacy Interface Extensions section of the WebRTC spec.\n * @param {Promise<*>} promise\n * @param {function<*>} onSuccess\n * @param {function<Error>} onFailure\n * @returns {Promise<undefined>}\n */\nfunction legacyPromise(promise, onSuccess, onFailure) {\n    if (onSuccess) {\n        return promise.then(function (result) {\n            onSuccess(result);\n        }, function (error) {\n            onFailure(error);\n        });\n    }\n    return promise;\n}\n/**\n * Build the {@link LogLevels} object.\n * @param {String|LogLevel} logLevel - Log level name or object\n * @returns {LogLevels}\n */\nfunction buildLogLevels(logLevel) {\n    if (typeof logLevel === 'string') {\n        return {\n            default: logLevel,\n            media: logLevel,\n            signaling: logLevel,\n            webrtc: logLevel\n        };\n    }\n    return logLevel;\n}\n/**\n * Get the {@link Track}'s derived class name\n * @param {Track} track\n * @param {?boolean} [local=undefined]\n * @returns {string}\n */\nfunction trackClass(track, local) {\n    local = local ? 'Local' : '';\n    return local + (track.kind || '').replace(/\\w{1}/, function (m) { return m.toUpperCase(); }) + \"Track\";\n}\n/**\n * Get the {@link TrackPublication}'s derived class name\n * @param {TrackPublication} publication\n * @param {?boolean} [local=undefined]\n * @returns {string}\n */\nfunction trackPublicationClass(publication, local) {\n    local = local ? 'Local' : '';\n    return local + (publication.kind || '').replace(/\\w{1}/, function (m) { return m.toUpperCase(); }) + \"TrackPublication\";\n}\n/**\n * Sets all underscore-prefixed properties on `object` non-enumerable.\n * @param {Object} object\n * @returns {void}\n */\nfunction hidePrivateProperties(object) {\n    Object.getOwnPropertyNames(object).forEach(function (name) {\n        if (name.startsWith('_')) {\n            hideProperty(object, name);\n        }\n    });\n}\n/**\n * Creates a new subclass which, in the constructor, sets all underscore-prefixed\n * properties and the given public properties non-enumerable. This is useful for\n * patching up classes like EventEmitter which may set properties like `_events`\n * and `domain`.\n * @param {Function} klass\n * @param {Array<string>} props\n * @returns {Function} subclass\n */\nfunction hidePrivateAndCertainPublicPropertiesInClass(klass, props) {\n    // NOTE(mroberts): We do this to avoid giving the class a name.\n    return /** @class */ (function (_super) {\n        __extends(class_1, _super);\n        function class_1() {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            var _this = _super.apply(this, __spreadArray([], __read(args))) || this;\n            hidePrivateProperties(_this);\n            hidePublicProperties(_this, props);\n            return _this;\n        }\n        return class_1;\n    }(klass));\n}\n/**\n * Hide a property of an object.\n * @param {object} object\n * @param {string} name\n */\nfunction hideProperty(object, name) {\n    var descriptor = Object.getOwnPropertyDescriptor(object, name);\n    descriptor.enumerable = false;\n    Object.defineProperty(object, name, descriptor);\n}\n/**\n * Hide the given public properties of an object.\n * @param {object} object\n * @param {Array<string>} [props=[]]\n */\nfunction hidePublicProperties(object, props) {\n    if (props === void 0) { props = []; }\n    props.forEach(function (name) {\n        // eslint-disable-next-line no-prototype-builtins\n        if (object.hasOwnProperty(name)) {\n            hideProperty(object, name);\n        }\n    });\n}\n/**\n * Convert an Array of values to an Array of JSON values by calling\n * `valueToJSON` on each value.\n * @param {Array<*>} array\n * @returns {Array<*>}\n */\nfunction arrayToJSON(array) {\n    return array.map(valueToJSON);\n}\n/**\n * Convert a Set of values to an Array of JSON values by calling `valueToJSON`\n * on each value.\n * @param {Set<*>} set\n * @returns {Array<*>}\n */\nfunction setToJSON(set) {\n    return arrayToJSON(__spreadArray([], __read(set)));\n}\n/**\n * Convert a Map from strings to values to an object of JSON values by calling\n * `valueToJSON` on each value.\n * @param {Map<string, *>} map\n * @returns {object}\n */\nfunction mapToJSON(map) {\n    return __spreadArray([], __read(map.entries())).reduce(function (json, _a) {\n        var _b;\n        var _c = __read(_a, 2), key = _c[0], value = _c[1];\n        return Object.assign((_b = {}, _b[key] = valueToJSON(value), _b), json);\n    }, {});\n}\n/**\n * Convert an object to a JSON value by calling `valueToJSON` on its enumerable\n * keys.\n * @param {object} object\n * @returns {object}\n */\nfunction objectToJSON(object) {\n    return Object.entries(object).reduce(function (json, _a) {\n        var _b;\n        var _c = __read(_a, 2), key = _c[0], value = _c[1];\n        return Object.assign((_b = {}, _b[key] = valueToJSON(value), _b), json);\n    }, {});\n}\n/**\n * Convert a value into a JSON value.\n * @param {*} value\n * @returns {*}\n */\nfunction valueToJSON(value) {\n    if (Array.isArray(value)) {\n        return arrayToJSON(value);\n    }\n    else if (value instanceof Set) {\n        return setToJSON(value);\n    }\n    else if (value instanceof Map) {\n        return mapToJSON(value);\n    }\n    else if (value && typeof value === 'object') {\n        return objectToJSON(value);\n    }\n    return value;\n}\nfunction createRoomConnectEventPayload(connectOptions) {\n    function boolToString(val) {\n        return val ? 'true' : 'false';\n    }\n    var payload = {\n        // arrays props converted to lengths.\n        iceServers: (connectOptions.iceServers || []).length,\n        audioTracks: (connectOptions.tracks || []).filter(function (track) { return track.kind === 'audio'; }).length,\n        videoTracks: (connectOptions.tracks || []).filter(function (track) { return track.kind === 'video'; }).length,\n        dataTracks: (connectOptions.tracks || []).filter(function (track) { return track.kind === 'data'; }).length,\n    };\n    // boolean properties.\n    [['audio'], ['automaticSubscription'], ['enableDscp'], ['eventListener'], ['preflight'], ['video'], ['dominantSpeaker', 'enableDominantSpeaker']].forEach(function (_a) {\n        var _b = __read(_a, 2), prop = _b[0], eventProp = _b[1];\n        eventProp = eventProp || prop;\n        payload[eventProp] = boolToString(!!connectOptions[prop]);\n    });\n    // numbers and string properties.\n    [['maxVideoBitrate'], ['maxAudioBitrate'], ['iceTransportPolicy'], ['region'], ['name', 'roomName']].forEach(function (_a) {\n        var _b = __read(_a, 2), prop = _b[0], eventProp = _b[1];\n        eventProp = eventProp || prop;\n        if (typeof connectOptions[prop] === 'number' || typeof connectOptions[prop] === 'string') {\n            payload[eventProp] = connectOptions[prop];\n        }\n    });\n    // array props stringified.\n    ['preferredAudioCodecs', 'preferredVideoCodecs'].forEach(function (prop) {\n        if (prop in connectOptions) {\n            payload[prop] = JSON.stringify(connectOptions[prop]);\n        }\n    });\n    if ('networkQuality' in connectOptions) {\n        payload.networkQualityConfiguration = {};\n        if (isNonArrayObject(connectOptions.networkQuality)) {\n            ['local', 'remote'].forEach(function (prop) {\n                if (typeof connectOptions.networkQuality[prop] === 'number') {\n                    payload.networkQualityConfiguration[prop] = connectOptions.networkQuality[prop];\n                }\n            });\n        }\n        else {\n            payload.networkQualityConfiguration.remote = 0;\n            payload.networkQualityConfiguration.local = connectOptions.networkQuality ? 1 : 0;\n        }\n    }\n    if (connectOptions.bandwidthProfile && connectOptions.bandwidthProfile.video) {\n        var videoBPOptions_1 = connectOptions.bandwidthProfile.video || {};\n        payload.bandwidthProfileOptions = {};\n        ['mode', 'maxTracks', 'trackSwitchOffMode', 'dominantSpeakerPriority', 'maxSubscriptionBitrate', 'renderDimensions', 'contentPreferencesMode', 'clientTrackSwitchOffControl'].forEach(function (prop) {\n            if (typeof videoBPOptions_1[prop] === 'number' || typeof videoBPOptions_1[prop] === 'string') {\n                payload.bandwidthProfileOptions[prop] = videoBPOptions_1[prop];\n            }\n            else if (typeof videoBPOptions_1[prop] === 'boolean') {\n                payload.bandwidthProfileOptions[prop] = boolToString(videoBPOptions_1[prop]);\n            }\n            else if (typeof videoBPOptions_1[prop] === 'object') {\n                payload.bandwidthProfileOptions[prop] = JSON.stringify(videoBPOptions_1[prop]);\n            }\n        });\n    }\n    return {\n        group: 'room',\n        name: 'connect',\n        level: 'info',\n        payload: payload\n    };\n}\n/**\n * Create the bandwidth profile payload included in an RSP connect message.\n * @param {BandwidthProfileOptions} bandwidthProfile\n * @returns {object}\n */\nfunction createBandwidthProfilePayload(bandwidthProfile) {\n    return createRSPPayload(bandwidthProfile, [\n        { prop: 'video', type: 'object', transform: createBandwidthProfileVideoPayload }\n    ]);\n}\n/**\n * Create the bandwidth profile video payload included in an RSP connect message.\n * @param {VideoBandwidthProfileOptions} bandwidthProfileVideo\n * @returns {object}\n */\nfunction createBandwidthProfileVideoPayload(bandwidthProfileVideo) {\n    return createRSPPayload(bandwidthProfileVideo, [\n        { prop: 'dominantSpeakerPriority', type: 'string', payloadProp: 'active_speaker_priority' },\n        { prop: 'maxSubscriptionBitrate', type: 'number', payloadProp: 'max_subscription_bandwidth' },\n        { prop: 'maxTracks', type: 'number', payloadProp: 'max_tracks' },\n        { prop: 'mode', type: 'string' },\n        { prop: 'renderDimensions', type: 'object', payloadProp: 'render_dimensions', transform: createRenderDimensionsPayload },\n        { prop: 'trackSwitchOffMode', type: 'string', payloadProp: 'track_switch_off' }\n    ]);\n}\n/**\n * Create the Media Signaling payload included in an RSP connect message.\n * @param {boolean} dominantSpeaker - whether to enable the Dominant Speaker\n *   protocol or not\n * @param {boolean} networkQuality - whether to enable the Network Quality\n *   protocol or not\n * @param {boolean} trackPriority - whether to enable the Track Priority\n *   protocol or not\n * @param {boolean} trackSwitchOff - whether to enable the Track Switch-Off\n *   protocol or not.\n * @param {boolean} renderHints - whether to enable the renderHints\n *   protocol or not.\n * @returns {object}\n */\nfunction createMediaSignalingPayload(dominantSpeaker, networkQuality, trackPriority, trackSwitchOff, renderHints) {\n    var transports = { transports: [{ type: 'data-channel' }] };\n    return Object.assign(dominantSpeaker\n        // eslint-disable-next-line\n        ? { active_speaker: transports }\n        : {}, networkQuality\n        // eslint-disable-next-line\n        ? { network_quality: transports }\n        : {}, renderHints\n        // eslint-disable-next-line\n        ? { render_hints: transports }\n        : {}, trackPriority\n        // eslint-disable-next-line\n        ? { track_priority: transports }\n        : {}, trackSwitchOff\n        // eslint-disable-next-line\n        ? { track_switch_off: transports }\n        : {});\n}\n/**\n * Create {@link VideoTrack.Dimensions} RSP payload.\n * @param {VideoTrack.Dimensions} [dimensions]\n * @returns {object}\n */\nfunction createDimensionsPayload(dimensions) {\n    return createRSPPayload(dimensions, [\n        { prop: 'height', type: 'number' },\n        { prop: 'width', type: 'number' }\n    ]);\n}\n/**\n * Create {@link VideoRenderDimensions} RSP payload.\n * @param renderDimensions\n * @returns {object}\n */\nfunction createRenderDimensionsPayload(renderDimensions) {\n    var PRIORITY_HIGH = trackPriority.PRIORITY_HIGH, PRIORITY_LOW = trackPriority.PRIORITY_LOW, PRIORITY_STANDARD = trackPriority.PRIORITY_STANDARD;\n    return createRSPPayload(renderDimensions, [\n        { prop: PRIORITY_HIGH, type: 'object', transform: createDimensionsPayload },\n        { prop: PRIORITY_LOW, type: 'object', transform: createDimensionsPayload },\n        { prop: PRIORITY_STANDARD, type: 'object', transform: createDimensionsPayload }\n    ]);\n}\n/**\n * Create an RSP payload for the given object.\n * @param {object} object - object for which RSP payload is to be generated\n * @param {Array<object>} propConversions - conversion rules for object properties;\n *   they specify how object properties should be converted to their corresponding\n *   RSP payload properties\n * @returns {object}\n */\nfunction createRSPPayload(object, propConversions) {\n    return propConversions.reduce(function (payload, _a) {\n        var _b;\n        var prop = _a.prop, type = _a.type, _c = _a.payloadProp, payloadProp = _c === void 0 ? prop : _c, _d = _a.transform, transform = _d === void 0 ? function (x) { return x; } : _d;\n        return typeof object[prop] === type\n            ? Object.assign((_b = {}, _b[payloadProp] = transform(object[prop]), _b), payload)\n            : payload;\n    }, {});\n}\n/**\n * Create the subscribe payload included in an RSP connect/update message.\n * @param {boolean} automaticSubscription - whether to subscribe to all RemoteTracks\n * @returns {object}\n */\nfunction createSubscribePayload(automaticSubscription) {\n    return {\n        rules: [{\n                type: automaticSubscription ? 'include' : 'exclude',\n                all: true\n            }],\n        revision: 1\n    };\n}\n/**\n * Add random jitter to a given value in the range [-jitter, jitter].\n * @private\n * @param {number} value\n * @param {number} jitter\n * @returns {number} value + random(-jitter, +jitter)\n */\nfunction withJitter(value, jitter) {\n    var rand = Math.random();\n    return value - jitter + Math.floor(2 * jitter * rand + 0.5);\n}\n/**\n * Checks if the a number is in the range [min, max].\n * @private\n * @param {num} num\n * @param {number} min\n * @param {number} max\n * @return {boolean}\n */\nfunction inRange(num, min, max) {\n    return min <= num && num <= max;\n}\n/**\n * returns true if given MediaStreamTrack is a screen share track\n * @private\n * @param {MediaStreamTrack} track\n * @returns {boolean}\n */\nfunction isChromeScreenShareTrack(track) {\n    // NOTE(mpatwardhan): Chrome creates screen share tracks with label like: \"screen:69734272*\"\n    // we will check for label that starts with \"screen:D\" where D being a digit.\n    var isChrome = util.guessBrowser() === 'chrome';\n    return isChrome && track.kind === 'video' && track.label && (/^screen:[0-9]+/.test(track.label) || /^web-contents-media-stream:[0-9/]+/.test(track.label) || /^window:[0-9]+/.test(track.label));\n}\n/**\n * returns true if given MediaStreamTrack is a user media track\n * @private\n * @param {MediaStreamTrack} track\n * @returns {boolean}\n */\nfunction isUserMediaTrack(track) {\n    // NOTE(mpatwardhan): tracks obtained from getUserMedia have a deviceId in its settings.\n    return typeof track.getSettings().deviceId === 'string';\n}\n/**\n * Returns a promise that resolve after timeoutMS have passed.\n * @param {number} timeoutMS - time to wait in milliseconds.\n * @returns {Promise<void>}\n */\nfunction waitForSometime(timeoutMS) {\n    if (timeoutMS === void 0) { timeoutMS = 10; }\n    return new Promise(function (resolve) { return setTimeout(resolve, timeoutMS); });\n}\n/**\n * Returns a promise that resolve after event is received\n * @returns {Promise<void>}\n */\nfunction waitForEvent(eventTarget, event) {\n    return new Promise(function (resolve) {\n        eventTarget.addEventListener(event, function onevent(e) {\n            eventTarget.removeEventListener(event, onevent);\n            resolve(e);\n        });\n    });\n}\nexports.constants = constants;\nexports.createBandwidthProfilePayload = createBandwidthProfilePayload;\nexports.createMediaSignalingPayload = createMediaSignalingPayload;\nexports.createRoomConnectEventPayload = createRoomConnectEventPayload;\nexports.createSubscribePayload = createSubscribePayload;\nexports.asLocalTrack = asLocalTrack;\nexports.asLocalTrackPublication = asLocalTrackPublication;\nexports.capitalize = capitalize;\nexports.deprecateEvents = deprecateEvents;\nexports.difference = difference;\nexports.filterObject = filterObject;\nexports.flatMap = flatMap;\nexports.getPlatform = getPlatform;\nexports.getUserAgent = getUserAgent;\nexports.hidePrivateProperties = hidePrivateProperties;\nexports.hidePrivateAndCertainPublicPropertiesInClass = hidePrivateAndCertainPublicPropertiesInClass;\nexports.isDeepEqual = isDeepEqual;\nexports.isNonArrayObject = isNonArrayObject;\nexports.inRange = inRange;\nexports.makeUUID = makeUUID;\nexports.oncePerTick = oncePerTick;\nexports.promiseFromEvents = promiseFromEvents;\nexports.getOrNull = getOrNull;\nexports.defer = defer;\nexports.delegateMethods = delegateMethods;\nexports.proxyProperties = proxyProperties;\nexports.legacyPromise = legacyPromise;\nexports.buildLogLevels = buildLogLevels;\nexports.trackClass = trackClass;\nexports.trackPublicationClass = trackPublicationClass;\nexports.valueToJSON = valueToJSON;\nexports.withJitter = withJitter;\nexports.isChromeScreenShareTrack = isChromeScreenShareTrack;\nexports.isUserMediaTrack = isUserMediaTrack;\nexports.waitForSometime = waitForSometime;\nexports.waitForEvent = waitForEvent;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}