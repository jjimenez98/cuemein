{"ast":null,"code":"'use strict';\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar EventEmitter = require('events').EventEmitter;\n/**\n * @classdesc A {@link DataTransport} implements {@link MediaSignalingTransport}\n *   in terms of an RTCDataChannel.\n * @extends EventEmitter\n * @implements MediaSignalingTransport\n * @emits DataTransport#message\n */\n\n\nvar DataTransport = function (_super) {\n  __extends(DataTransport, _super);\n  /**\n   * Construct a {@link DataTransport}.\n   * @param {RTCDataChannel} dataChannel\n   */\n\n\n  function DataTransport(dataChannel) {\n    var _this = _super.call(this) || this;\n\n    Object.defineProperties(_this, {\n      _dataChannel: {\n        value: dataChannel\n      },\n      _messageQueue: {\n        value: []\n      }\n    });\n    dataChannel.addEventListener('open', function () {\n      _this._messageQueue.splice(0).forEach(function (message) {\n        return _this._publish(message);\n      });\n    });\n    dataChannel.addEventListener('message', function (_a) {\n      var data = _a.data;\n\n      try {\n        var message = JSON.parse(data);\n\n        _this.emit('message', message);\n      } catch (error) {// Do nothing.\n      }\n    });\n\n    _this.publish({\n      type: 'ready'\n    });\n\n    return _this;\n  }\n  /**\n   * @param message\n   * @private\n   */\n\n\n  DataTransport.prototype._publish = function (message) {\n    var data = JSON.stringify(message);\n\n    try {\n      this._dataChannel.send(data);\n    } catch (error) {// Do nothing.\n    }\n  };\n  /**\n   * Publish a message. Returns true if calling the method resulted in\n   * publishing (or eventually publishing) the update.\n   * @param {object} message\n   * @returns {boolean}\n   */\n\n\n  DataTransport.prototype.publish = function (message) {\n    var dataChannel = this._dataChannel;\n\n    if (dataChannel.readyState === 'closing' || dataChannel.readyState === 'closed') {\n      return false;\n    }\n\n    if (dataChannel.readyState === 'connecting') {\n      this._messageQueue.push(message);\n\n      return true;\n    }\n\n    this._publish(message);\n\n    return true;\n  };\n\n  return DataTransport;\n}(EventEmitter);\n/**\n * The {@link DataTransport} received a message.\n * @event DataTransport#message\n * @param {object} message\n */\n\n\nmodule.exports = DataTransport;","map":{"version":3,"sources":["../../lib/data/transport.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEQ,IAAA,YAAY,GAAK,OAAO,CAAC,QAAD,CAAP,CAAL,YAAZ;AAER;;;;;;AAMG;;;AACH,IAAA,aAAA,GAAA,UAAA,MAAA,EAAA;AAA4B,EAAA,SAAA,CAAA,aAAA,EAAA,MAAA,CAAA;AAC1B;;;AAGG;;;AACH,WAAA,aAAA,CAAY,WAAZ,EAAuB;AAAvB,QAAA,KAAA,GACE,MAAA,CAAA,IAAA,CAAA,IAAA,KAAO,IADT;;AAGE,IAAA,MAAM,CAAC,gBAAP,CAAwB,KAAxB,EAA8B;AAC5B,MAAA,YAAY,EAAE;AACZ,QAAA,KAAK,EAAE;AADK,OADc;AAI5B,MAAA,aAAa,EAAE;AACb,QAAA,KAAK,EAAE;AADM;AAJa,KAA9B;AASA,IAAA,WAAW,CAAC,gBAAZ,CAA6B,MAA7B,EAAqC,YAAA;AACnC,MAAA,KAAI,CAAC,aAAL,CAAmB,MAAnB,CAA0B,CAA1B,EAA6B,OAA7B,CAAqC,UAAA,OAAA,EAAO;AAAI,eAAA,KAAI,CAAC,QAAL,CAAA,OAAA,CAAA;AAAsB,OAAtE;AACD,KAFD;AAIA,IAAA,WAAW,CAAC,gBAAZ,CAA6B,SAA7B,EAAwC,UAAC,EAAD,EAAS;UAAN,IAAI,GAAA,EAAA,CAAA,I;;AAC7C,UAAI;AACF,YAAM,OAAO,GAAG,IAAI,CAAC,KAAL,CAAW,IAAX,CAAhB;;AACA,QAAA,KAAI,CAAC,IAAL,CAAU,SAAV,EAAqB,OAArB;AACD,OAHD,CAGE,OAAO,KAAP,EAAc,CACd;AACD;AACF,KAPD;;AASA,IAAA,KAAI,CAAC,OAAL,CAAa;AAAE,MAAA,IAAI,EAAE;AAAR,KAAb;;;AACD;AAED;;;AAGG;;;AACH,EAAA,aAAA,CAAA,SAAA,CAAA,QAAA,GAAA,UAAS,OAAT,EAAgB;AACd,QAAM,IAAI,GAAG,IAAI,CAAC,SAAL,CAAe,OAAf,CAAb;;AACA,QAAI;AACF,WAAK,YAAL,CAAkB,IAAlB,CAAuB,IAAvB;AACD,KAFD,CAEE,OAAO,KAAP,EAAc,CACd;AACD;AACF,GAPD;AASA;;;;;AAKG;;;AACH,EAAA,aAAA,CAAA,SAAA,CAAA,OAAA,GAAA,UAAQ,OAAR,EAAe;AACb,QAAM,WAAW,GAAG,KAAK,YAAzB;;AACA,QAAI,WAAW,CAAC,UAAZ,KAA2B,SAA3B,IAAwC,WAAW,CAAC,UAAZ,KAA2B,QAAvE,EAAiF;AAC/E,aAAO,KAAP;AACD;;AACD,QAAI,WAAW,CAAC,UAAZ,KAA2B,YAA/B,EAA6C;AAC3C,WAAK,aAAL,CAAmB,IAAnB,CAAwB,OAAxB;;AACA,aAAO,IAAP;AACD;;AACD,SAAK,QAAL,CAAc,OAAd;;AACA,WAAO,IAAP;AACD,GAXD;;AAYF,SAAA,aAAA;AAAC,CAhED,CAA4B,YAA5B,CAAA;AAkEA;;;;AAIG;;;AAEH,MAAM,CAAC,OAAP,GAAiB,aAAjB","sourceRoot":"","sourcesContent":["'use strict';\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar EventEmitter = require('events').EventEmitter;\n/**\n * @classdesc A {@link DataTransport} implements {@link MediaSignalingTransport}\n *   in terms of an RTCDataChannel.\n * @extends EventEmitter\n * @implements MediaSignalingTransport\n * @emits DataTransport#message\n */\nvar DataTransport = /** @class */ (function (_super) {\n    __extends(DataTransport, _super);\n    /**\n     * Construct a {@link DataTransport}.\n     * @param {RTCDataChannel} dataChannel\n     */\n    function DataTransport(dataChannel) {\n        var _this = _super.call(this) || this;\n        Object.defineProperties(_this, {\n            _dataChannel: {\n                value: dataChannel\n            },\n            _messageQueue: {\n                value: []\n            }\n        });\n        dataChannel.addEventListener('open', function () {\n            _this._messageQueue.splice(0).forEach(function (message) { return _this._publish(message); });\n        });\n        dataChannel.addEventListener('message', function (_a) {\n            var data = _a.data;\n            try {\n                var message = JSON.parse(data);\n                _this.emit('message', message);\n            }\n            catch (error) {\n                // Do nothing.\n            }\n        });\n        _this.publish({ type: 'ready' });\n        return _this;\n    }\n    /**\n     * @param message\n     * @private\n     */\n    DataTransport.prototype._publish = function (message) {\n        var data = JSON.stringify(message);\n        try {\n            this._dataChannel.send(data);\n        }\n        catch (error) {\n            // Do nothing.\n        }\n    };\n    /**\n     * Publish a message. Returns true if calling the method resulted in\n     * publishing (or eventually publishing) the update.\n     * @param {object} message\n     * @returns {boolean}\n     */\n    DataTransport.prototype.publish = function (message) {\n        var dataChannel = this._dataChannel;\n        if (dataChannel.readyState === 'closing' || dataChannel.readyState === 'closed') {\n            return false;\n        }\n        if (dataChannel.readyState === 'connecting') {\n            this._messageQueue.push(message);\n            return true;\n        }\n        this._publish(message);\n        return true;\n    };\n    return DataTransport;\n}(EventEmitter));\n/**\n * The {@link DataTransport} received a message.\n * @event DataTransport#message\n * @param {object} message\n */\nmodule.exports = DataTransport;\n//# sourceMappingURL=transport.js.map"]},"metadata":{},"sourceType":"script"}