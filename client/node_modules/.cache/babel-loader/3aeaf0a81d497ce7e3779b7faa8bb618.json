{"ast":null,"code":"'use strict';\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar RemoteParticipantSignaling = require('../remoteparticipant');\n\nvar RemoteTrackPublicationV2 = require('./remotetrackpublication');\n/**\n * @extends RemoteParticipantSignaling\n * @property {?number} revision\n */\n\n\nvar RemoteParticipantV2 = function (_super) {\n  __extends(RemoteParticipantV2, _super);\n  /**\n   * Construct a {@link RemoteParticipantV2}.\n   * @param {object} participantState\n   * @param {function(Track.SID): boolean} getInitialTrackSwitchOffState\n   * @param {function(Track.SID, Track.Priority): boolean} setPriority\n   * @param {function(Track.SID, ClientRenderHint): Promise<void>} setRenderHint\n   * @param {function(Track.SID): void} clearTrackHint\n   * @param {object} [options]\n   */\n\n\n  function RemoteParticipantV2(participantState, getInitialTrackSwitchOffState, setPriority, setRenderHint, clearTrackHint, options) {\n    var _this = _super.call(this, participantState.sid, participantState.identity) || this;\n\n    options = Object.assign({\n      RemoteTrackPublicationV2: RemoteTrackPublicationV2\n    }, options);\n    Object.defineProperties(_this, {\n      _revision: {\n        writable: true,\n        value: null\n      },\n      _RemoteTrackPublicationV2: {\n        value: options.RemoteTrackPublicationV2\n      },\n      _getInitialTrackSwitchOffState: {\n        value: getInitialTrackSwitchOffState\n      },\n      updateSubscriberTrackPriority: {\n        value: function value(trackSid, priority) {\n          return setPriority(trackSid, priority);\n        }\n      },\n      updateTrackRenderHint: {\n        value: function value(trackSid, renderHint) {\n          return setRenderHint(trackSid, renderHint);\n        }\n      },\n      clearTrackHint: {\n        value: function value(trackSid) {\n          return clearTrackHint(trackSid);\n        }\n      },\n      revision: {\n        enumerable: true,\n        get: function get() {\n          return this._revision;\n        }\n      }\n    });\n    return _this.update(participantState);\n  }\n  /**\n   * @private\n   */\n\n\n  RemoteParticipantV2.prototype._getOrCreateTrack = function (trackState) {\n    var RemoteTrackPublicationV2 = this._RemoteTrackPublicationV2;\n    var track = this.tracks.get(trackState.sid);\n\n    if (!track) {\n      var isSwitchedOff = this._getInitialTrackSwitchOffState(trackState.sid);\n\n      track = new RemoteTrackPublicationV2(trackState, isSwitchedOff);\n      this.addTrack(track);\n    }\n\n    return track;\n  };\n  /**\n   * Update the {@link RemoteParticipantV2} with the new state.\n   * @param {object} participantState\n   * @returns {this}\n   */\n\n\n  RemoteParticipantV2.prototype.update = function (participantState) {\n    var _this = this;\n\n    if (this.revision !== null && participantState.revision <= this.revision) {\n      return this;\n    }\n\n    this._revision = participantState.revision;\n    var tracksToKeep = new Set();\n    participantState.tracks.forEach(function (trackState) {\n      var track = _this._getOrCreateTrack(trackState);\n\n      track.update(trackState);\n      tracksToKeep.add(track);\n    });\n    this.tracks.forEach(function (track) {\n      if (!tracksToKeep.has(track)) {\n        _this.removeTrack(track);\n      }\n    });\n\n    switch (participantState.state) {\n      case 'disconnected':\n        this.disconnect();\n        break;\n\n      case 'reconnecting':\n        this.reconnecting();\n        break;\n\n      case 'connected':\n        this.connect(this.sid, this.identity);\n        break;\n    }\n\n    return this;\n  };\n\n  return RemoteParticipantV2;\n}(RemoteParticipantSignaling);\n\nmodule.exports = RemoteParticipantV2;","map":{"version":3,"sources":["../../../lib/signaling/v2/remoteparticipant.js"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["'use strict';\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar RemoteParticipantSignaling = require('../remoteparticipant');\nvar RemoteTrackPublicationV2 = require('./remotetrackpublication');\n/**\n * @extends RemoteParticipantSignaling\n * @property {?number} revision\n */\nvar RemoteParticipantV2 = /** @class */ (function (_super) {\n    __extends(RemoteParticipantV2, _super);\n    /**\n     * Construct a {@link RemoteParticipantV2}.\n     * @param {object} participantState\n     * @param {function(Track.SID): boolean} getInitialTrackSwitchOffState\n     * @param {function(Track.SID, Track.Priority): boolean} setPriority\n     * @param {function(Track.SID, ClientRenderHint): Promise<void>} setRenderHint\n     * @param {function(Track.SID): void} clearTrackHint\n     * @param {object} [options]\n     */\n    function RemoteParticipantV2(participantState, getInitialTrackSwitchOffState, setPriority, setRenderHint, clearTrackHint, options) {\n        var _this = _super.call(this, participantState.sid, participantState.identity) || this;\n        options = Object.assign({\n            RemoteTrackPublicationV2: RemoteTrackPublicationV2\n        }, options);\n        Object.defineProperties(_this, {\n            _revision: {\n                writable: true,\n                value: null\n            },\n            _RemoteTrackPublicationV2: {\n                value: options.RemoteTrackPublicationV2\n            },\n            _getInitialTrackSwitchOffState: {\n                value: getInitialTrackSwitchOffState\n            },\n            updateSubscriberTrackPriority: {\n                value: function (trackSid, priority) { return setPriority(trackSid, priority); }\n            },\n            updateTrackRenderHint: {\n                value: function (trackSid, renderHint) { return setRenderHint(trackSid, renderHint); }\n            },\n            clearTrackHint: {\n                value: function (trackSid) { return clearTrackHint(trackSid); }\n            },\n            revision: {\n                enumerable: true,\n                get: function () {\n                    return this._revision;\n                }\n            }\n        });\n        return _this.update(participantState);\n    }\n    /**\n     * @private\n     */\n    RemoteParticipantV2.prototype._getOrCreateTrack = function (trackState) {\n        var RemoteTrackPublicationV2 = this._RemoteTrackPublicationV2;\n        var track = this.tracks.get(trackState.sid);\n        if (!track) {\n            var isSwitchedOff = this._getInitialTrackSwitchOffState(trackState.sid);\n            track = new RemoteTrackPublicationV2(trackState, isSwitchedOff);\n            this.addTrack(track);\n        }\n        return track;\n    };\n    /**\n     * Update the {@link RemoteParticipantV2} with the new state.\n     * @param {object} participantState\n     * @returns {this}\n     */\n    RemoteParticipantV2.prototype.update = function (participantState) {\n        var _this = this;\n        if (this.revision !== null && participantState.revision <= this.revision) {\n            return this;\n        }\n        this._revision = participantState.revision;\n        var tracksToKeep = new Set();\n        participantState.tracks.forEach(function (trackState) {\n            var track = _this._getOrCreateTrack(trackState);\n            track.update(trackState);\n            tracksToKeep.add(track);\n        });\n        this.tracks.forEach(function (track) {\n            if (!tracksToKeep.has(track)) {\n                _this.removeTrack(track);\n            }\n        });\n        switch (participantState.state) {\n            case 'disconnected':\n                this.disconnect();\n                break;\n            case 'reconnecting':\n                this.reconnecting();\n                break;\n            case 'connected':\n                this.connect(this.sid, this.identity);\n                break;\n        }\n        return this;\n    };\n    return RemoteParticipantV2;\n}(RemoteParticipantSignaling));\nmodule.exports = RemoteParticipantV2;\n//# sourceMappingURL=remoteparticipant.js.map"]},"metadata":{},"sourceType":"script"}