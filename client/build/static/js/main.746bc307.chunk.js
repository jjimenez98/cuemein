(this.webpackJsonpcapstone=this.webpackJsonpcapstone||[]).push([[0],{101:function(e,t,n){},102:function(e,t,n){},103:function(e,t,n){},222:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),i=n(95),o=n.n(i),s=(n(101),n(102),n(103),n(22)),r=n.n(s),l=n(32),d=n(9),u=n(223),m=n(224),j=n(225),b=n(226),f=(n(30),n(1)),h=function(e){var t=e.username,n=e.handleUsernameChange,a=e.roomName,c=e.handleRoomNameChange,i=e.handleSubmit;return Object(f.jsxs)(u.a,{className:"controlpanel",fluid:!0,children:[Object(f.jsx)(m.a,{className:"cmilogo",children:Object(f.jsx)("img",{src:"/cuemeinlogo.png",width:"400",height:"400"})}),Object(f.jsx)(m.a,{className:"control",children:Object(f.jsxs)(j.a,{onSubmit:i,children:[Object(f.jsx)(j.a.Label,{className:"meeting",children:"Join a Meeting"}),Object(f.jsxs)(j.a.Group,{children:[Object(f.jsx)(j.a.Label,{className:"name",children:"Name:"}),Object(f.jsx)(j.a.Control,{className:"inputname",size:"lg",type:"name",value:t,onChange:n,placeholder:"User ID"})]}),Object(f.jsxs)(j.a.Group,{children:[Object(f.jsx)(j.a.Label,{className:"meetingname",children:"Meeting name:"}),Object(f.jsx)(j.a.Control,{className:"inputmeetingname",size:"lg",type:"meetingname",value:a,onChange:c,placeholder:"Room Name"})]}),Object(f.jsx)(b.a,{variant:"success",type:"submit",children:"JOIN"})]})})]})},O=n(17),p=n(44),v=n.n(p),x=n(11),g=n(12),N=void 0,k=n(94),y=(k.muteYourAudio,k.unmuteYourAudio,function(e){var t=e.user,n=(e.mute,e.local),c=void 0===n?"":n,i=Object(a.useState)([]),o=Object(d.a)(i,2),s=o[0],r=o[1],l=Object(a.useState)([]),u=Object(d.a)(l,2),m=u[0],j=u[1],b=Object(a.useState)(!1),h=Object(d.a)(b,2),p=h[0],v=h[1],k=Object(a.useState)(!1),y=Object(d.a)(k,2),S=y[0],E=y[1],C=Object(a.useState)(""),w=Object(d.a)(C,2),T=(w[0],w[1],Object(a.useRef)()),R=Object(a.useRef)(),P="black-box";console.log("User.js",t.identity);var A=function(e){v(e),console.log("toggle mute",e)},D=function(e){console.log("toggleVmute",e),E(e)},I=function(e){return Array.from(e.values()).map((function(e){return e.track})).filter((function(e){return null!==e}))};function L(e,t){var n,a,c=document.getElementById(t);c.innerHTML=e,n=c,a="appear",setTimeout((function(){n.classList.remove(a)}),5e3),n.classList.add(a)}return Object(a.useEffect)((function(){r(I(t.videoTracks)),j(I(t.audioTracks)),t.videoTracks.forEach((function(e){e.on("trackEnabled",D.bind(N,!1)),e.on("trackDisabled",D.bind(N,!0))})),t.audioTracks.forEach((function(e){e.on("trackEnabled",A.bind(N,!1)),e.on("trackDisabled",A.bind(N,!0))}));return t.on("trackSubscribed",(function(e){console.log(e,"track subs"),"video"===e.kind?(E(!e.isEnabled),r((function(t){return[].concat(Object(O.a)(t),[e])}))):"audio"===e.kind?(v(!e.isEnabled),j((function(t){return[].concat(Object(O.a)(t),[e])}))):"data"==e.kind&&(e.on("message",(function(t){console.log("DATA REACTION"),console.log(JSON.parse(t).emojiData,e.sid),console.log(JSON.parse(t).user,"reaction id"),function(e,t){console.log(e);var n=document.getElementById(e);console.log(n,"user.id DIV");var a=document.createElement("div");a.setAttribute("id",t.sid),a.setAttribute("class","emoji"),n.appendChild(a)}(JSON.parse(t).user,e),L(JSON.parse(t).emojiData,e.sid)})),console.log("TRACK"),console.log("TRACK",e))})),t.on("trackUnsubscribed",(function(e){"video"===e.kind?r((function(t){return t.filter((function(t){return t!==e}))})):"audio"===e.kind&&j((function(t){return t.filter((function(t){return t!==e}))}))})),function(){r([]),j([]),t.removeAllListeners()}}),[t]),Object(a.useEffect)((function(){var e=s[0];if(e)return console.log("User.js attach()",t.identity),e.attach(T.current),function(){console.log("User.js detach()",t.identity),e.detach()}}),[s]),Object(a.useEffect)((function(){var e=m[0];if(e)return e.attach(R.current),function(){e.detach()}}),[m]),P="i"===c?"participant-video-emptyi":"participant-video-empty",Object(f.jsxs)("div",{className:"user-camera",children:[Object(f.jsx)("div",{id:t.sid,className:"user-camera-reaction"}),Object(f.jsxs)("div",{className:"user-camera-box",children:[S?Object(f.jsx)("div",{className:"black-box",children:"fds"}):"",S?Object(f.jsx)(x.a,{className:"empty-icon-video",icon:g.b,size:"2x"}):"",S?Object(f.jsx)("video",{className:P,width:"100%",ref:T}):Object(f.jsx)("video",{className:"participant-video",width:"100%",ref:T,autoPlay:!0})]}),Object(f.jsxs)("div",{className:"participant-border",children:[Object(f.jsx)("div",{className:"participant-border-name",children:t.identity}),p?Object(f.jsx)("div",{className:"muted-bg",children:Object(f.jsx)(x.a,{className:"muted",icon:g.j,size:"1x"})}):""]}),Object(f.jsx)("audio",{ref:R,autoPlay:!0,muted:!0})]})}),S=function(e){var t=e.room,n=Object(a.useState)([]),c=Object(d.a)(n,2),i=c[0],o=c[1],s=Object(a.useState)([]),u=Object(d.a)(s,2),j=u[0],b=u[1],h=Object(a.useState)("-"),p=Object(d.a)(h,2),v=p[0],N=p[1],k=Object(a.useState)("participant-video"),y=Object(d.a)(k,2),S=(y[0],y[1],Object(a.useState)(null)),E=Object(d.a)(S,2),C=E[0],w=E[1],T=Object(a.useRef)();Object(a.useRef)();Object(a.useEffect)((function(){null!==t&&t.on("dominantSpeakerChanged",(function(e){w(e),console.log("new dominant speaker Dominant.js")}))}),[t]);var R=function(e){return Array.from(e.values()).map((function(e){return e.track})).filter((function(e){return null!==e}))};Object(a.useEffect)((function(){if(null!=C){o(R(C.videoTracks)),b(R(C.audioTracks));return C.on("trackSubscribed",(function(e){"video"===e.kind?o((function(t){return[].concat(Object(O.a)(t),[e])})):"audio"===e.kind?b((function(t){return[].concat(Object(O.a)(t),[e])})):"data"==e.kind&&e.on("message",(function(e){console.log(JSON.parse(e).user,JSON.parse(e).emojiData,JSON.parse(e).identity,"Dominant-REACTION")}))})),C.on("trackUnsubscribed",(function(e){"video"===e.kind?o((function(t){return t.filter((function(t){return t!==e}))})):"audio"===e.kind&&b((function(t){return t.filter((function(t){return t!==e}))}))})),function(){o([]),b([]),C.removeAllListeners()}}}),[C]);var P,A,D=function(){var e=Object(l.a)(r.a.mark((function e(){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="/emotion?identity="+C.identity+"&room="+t.name,e.next=3,fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()}));case 3:a=e.sent,N(a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(e,t){var n=new MediaRecorder(e),a=[];n.ondataavailable=function(e){return a.push(e.data)},n.start();var c,i=new Promise((function(e,t){n.onstop=e,n.onerror=function(e){return t(e.name)}})),o=(c=t,new Promise((function(e){return setTimeout(e,c)}))).then((function(){return"recording"==n.state&&n.stop()}));return Promise.all([i,o]).then((function(){return a}))};return Object(a.useEffect)((function(){if(null!=C){var e=i[0];e&&e.attach(T.current)}}),[i]),Object(a.useEffect)((function(){var e=setInterval((function(){if(null!=C&&i[0].isEnabled){var e=i[0];e&&(n=e.mediaStreamTrack,new ImageCapture(n).grabFrame().then((function(e){var n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0),n.toBlob((function(e){var n=new FileReader;n.addEventListener("loadend",(function(){fetch(n.result).then((function(e){return e.blob()})).then((function(e){var n="/video/snapShot?identity="+C.identity+"&room="+t.name;fetch(n,{method:"POST",body:e,headers:{"Content-Type":"application/octet-stream"}}).then((function(){D()}))}))})),n.readAsDataURL(e)}),"image/jpeg")})).catch((function(e){console.log("takePhoto() error: ",e)})))}var n}),2e3);return function(){clearInterval(e)}}),[i]),Object(a.useEffect)((function(){var e=setInterval((function(){if(console.log("New function called"),null!=C&&!i[0].isEnabled){var e=j[0];e&&function(e,n){var a=new MediaStream;a.addTrack(e),new MediaRecorder(a),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(){return I(a,n)})).then((function(e){var n=new Blob(e,{type:"application/octet-stream"}),a=new FileReader;a.addEventListener("loadend",(function(){fetch(a.result).then((function(e){return e.blob()})).then((function(e){var n="/audio/snapShot?identity="+C.identity+"&room="+t.name;fetch(n,{method:"POST",body:e,headers:{"Content-Type":"application/octet-stream"}}).then((function(){D()}))}))})),a.readAsDataURL(n)}))}(e.mediaStreamTrack,1e4)}}),1e4);return function(){clearInterval(e)}}),[j]),"happiness"===v.emotion?(P=Object(f.jsx)(x.a,{className:"dominant-emotion-happy emotion",icon:g.f,size:"2x"}),A="HAPPY"):"anger"===v.emotion?(P=Object(f.jsx)(x.a,{className:"dominant-emotion-angry emotion",icon:g.a,size:"2x"}),A="ANGRY"):"sadness"===v.emotion?(P=Object(f.jsx)(x.a,{className:"dominant-emotion-sadness emotion",icon:g.k,size:"2x"}),A="SADNESS"):"fear"===v.emotion?(P=Object(f.jsx)(x.a,{className:"dominant-emotion-fear emotion",icon:g.c,size:"2x"}),A="FEAR"):"disgust"===v.emotion?(P=Object(f.jsx)(x.a,{className:"dominant-emotion-disgust emotion",icon:g.m,size:"2x"}),A="DISGUST"):"neutral"===v.emotion?(P=Object(f.jsx)(x.a,{className:"dominant-emotion-neutral emotion",icon:g.g,size:"2x"}),A="NEUTRAL"):"surprise"===v.emotion?(P=Object(f.jsx)(x.a,{className:"dominant-emotion-surprised emotion",icon:g.d,size:"2x"}),A="SURPRISE"):"-"===v.emotion&&(P=Object(f.jsx)(x.a,{className:"dominant-emotion-undefined emotion",icon:g.h,size:"2x"}),A="UNDEFINED"),Object(f.jsxs)(m.a,{className:"dominant-camera",children:[Object(f.jsx)("div",{id:"das",className:"dominant-camera-reaction"}),C?Object(f.jsx)("video",{className:"participant-video-dominant",width:"100%",height:"100%",ref:T,autoPlay:!0}):Object(f.jsx)("div",{className:"default-video-dominant",children:Object(f.jsx)(x.a,{className:"dominant-camera-default",icon:g.n,size:"2x"})}),Object(f.jsxs)("div",{className:"dominant-border-emotion-icon",children:[Object(f.jsx)("h3",{className:"dominant-border-emotion-header",children:"Emotion"}),Object(f.jsx)("div",{className:"dominant-icon",children:P})]}),Object(f.jsxs)("div",{className:"dominant-border",children:[C?Object(f.jsx)("div",{className:"dominant-border-name",children:C.identity}):"",Object(f.jsx)("div",{className:"dominant-border-emotion-background",children:Object(f.jsx)("div",{className:"dominant-border-emotion-text",children:A})})]})]})},E=n(96),C=function(e){var t,c,i=e.meetingname,o=e.token,s=(e.emotion,e.logout),r=(e.test,Object(a.useState)(null)),l=Object(d.a)(r,2),j=l[0],b=l[1],h=Object(a.useState)([]),p=Object(d.a)(h,2),N=p[0],k=p[1],C=Object(a.useState)(""),w=Object(d.a)(C,2),T=w[0],R=w[1],P=Object(a.useState)(!1),A=Object(d.a)(P,2),D=A[0],I=A[1],L=Object(a.useState)(!1),z=Object(d.a)(L,2),U=z[0],M=z[1],Y=Object(a.useState)(!1),J=Object(d.a)(Y,2),B=J[0],F=J[1],G=n(94),V=G.muteYourAudio,H=G.unmuteYourAudio,K=n(44).LocalDataTrack;console.log("Room.js render");var q=function(e,t){if(!e.localParticipant.videoTracks.entries().next()){var n=e.localParticipant.videoTracks.entries().next().value[1].track.mediaStreamTrack;new ImageCapture(n).grabFrame().then((function(t){console.log("bitmap :",t);var n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0),n.toBlob((function(t){var n=new FileReader;n.addEventListener("loadend",(function(){fetch(n.result).then((function(e){return e.blob()})).then((function(t){fetch("/video/snapShot?identity="+e.localParticipant.identity+"&room="+e.name,{method:"POST",body:t,headers:{"Content-Type":"application/octet-stream"}})}))})),n.readAsDataURL(t)}),"image/jpeg")})).catch((function(e){console.log("takePhoto() error: ",e)}))}},Q=function(e){console.log(e),e.forEach((function(e){fetch("/video/emotion?identity="+e.identity+"&room="+j.name,{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(t){e.emotion=t.body.emotion}))}))},W=function(e){c&&window.clearInterval(c),c=window.setInterval(Q,1e4,e)};Object(a.useEffect)((function(){console.log("dominant speacjer Room.js effect");var e,n=function(e){console.log("Room.js - particiapnt connected",e),k((function(t){return[].concat(Object(O.a)(t),[e])})),W(N)},a=function(e){console.log("Room.js - particiapnt disconnected",e,N),k((function(t){return t.filter((function(t){return t!==e}))})),W(N),console.log(N)},c=function(e){null!==e?R(e.identity):null===e&&R(null)},s=function(e,t){};function r(e){var t,n,a=document.getElementById("datalocal");a.innerHTML=e,t=a,n="appear",setTimeout((function(){t.classList.remove(n)}),1e3),t.classList.add(n)}function l(t){var n=t.target.innerHTML;r(n),b((function(t){var a,c,i;return console.log("id",t),a=n,c=t.localParticipant.sid,i=t.identity,e.send(JSON.stringify({emojiData:a,user:c,identity:i})),t})),console.log("id",j,"fdsafsadas")}return function(){for(var e=document.getElementsByClassName("emojibuttons"),t=0;t<e.length;t++)e[t].addEventListener("click",l)}(),function(){var t=new K;e=t}(),v.a.connect(o,{name:i,dominantSpeaker:!0,audio:!0,video:!0}).then((function(i){console.log("Room.js - line 59 - video.connect",i),b(i),i.on("participantConnected",n),i.on("participantDisconnected",a),i.on("dominantSpeakerChanged",c),i.on("trackDisabled",s),i.localParticipant.publishTrack(e),i.participants.forEach(n),t=window.setInterval(q,5e4,i,N)})),function(){t&&window.clearInterval(t),b((function(e){return e&&"connected"===e.localParticipant.state?(e.localParticipant.tracks.forEach((function(e){e.track.stop()})),console.log("disconnect!!!!!!"),e.disconnect(),null):e}))}}),[i,o]);var X=Object(a.useCallback)((function(){console.log("called mutecallback, button pressed"),!1===D&&null!==j?(G.muteYourAudio(j),I(!0)):!0===D&&null!==j&&(G.unmuteYourAudio(j),I(!1))}),[D,j]),Z=Object(a.useCallback)((function(){console.log("called mutevideocallback, button pressed"),!1===U&&null!==j?(G.muteYourVideo(j),M(!0)):!0===U&&null!==j&&(G.unmuteYourVideo(j),M(!1))}),[U,j]),$=Object(a.useCallback)((function(){console.log("called deafencallback, button pressed"),!1===B&&null!==j?(V(j),F(!0)):!0===B&&null!=j&&(H(j),F(!1))}),[j,B]),_=Object(a.useCallback)((function(){console.log("testing - line 125!!!!!!",j),j&&"connected"===j.localParticipant.state&&(j.localParticipant.tracks.forEach((function(e){"video"!=e.track.kind&&"audio"!=e.track.kind||e.track.stop()})),j.disconnect()),s()}),[j]),ee=N.map((function(e,t){return Object(f.jsx)(y,{user:e,mute:B},t)}));return Object(f.jsxs)("div",{className:"room",children:[Object(f.jsx)(u.a,{className:"cameras",fluid:"true",children:Object(f.jsxs)(m.a,{className:"cameras-row",children:[Object(f.jsxs)(E.a,{sm:2,className:"local-participant",children:[j?Object(f.jsxs)("div",{className:"local-participant-camera",children:[Object(f.jsx)(y,{user:j.localParticipant,mute:B,local:"i"},j.localParticipant.sid),Object(f.jsx)("div",{id:"datalocal",className:"emoji"})]}):"",Object(f.jsx)("div",{className:"remote-participants",children:ee})]}),Object(f.jsxs)(E.a,{sm:10,className:"dominant",children:[Object(f.jsx)(S,{className:"dominant-user",room:j},"dominant"),Object(f.jsx)("div",{className:"dominant-header-bg",children:Object(f.jsxs)("div",{className:"dominant-header",children:[Object(f.jsxs)("div",{className:"dominant-header-room",children:["Room Name: ",i]}),Object(f.jsxs)("div",{className:"dominant-header-speaker",children:["Talking: ",T]})]})})]})]})}),Object(f.jsx)(u.a,{fluid:"true",children:Object(f.jsx)("div",{className:"toolbar",children:Object(f.jsxs)("div",{className:"toolbar-items",children:[Object(f.jsx)("div",{className:"logoutbutton",children:Object(f.jsx)("button",{className:"logoutbutton-btn danger",onClick:_,children:"LOG OUT"})}),Object(f.jsxs)("div",{className:"btns-toolbar",children:[Object(f.jsx)("div",{className:"col-audio",children:D?Object(f.jsxs)("button",{className:"btn1 info",onClick:X,children:[Object(f.jsx)("span",{className:"btn2",children:"Mute"}),Object(f.jsx)(x.a,{className:"btnsize",icon:g.j})]}):Object(f.jsxs)("button",{className:"btn1 info",onClick:X,children:[Object(f.jsx)("span",{className:"btn2",children:"Mute"}),Object(f.jsx)(x.a,{className:"btnsize",icon:g.i})]})}),Object(f.jsx)("div",{className:"col-video",children:U?Object(f.jsxs)("button",{className:"btn1 info",onClick:Z,children:[Object(f.jsx)("span",{className:"btn2",children:"Camera"}),Object(f.jsx)(x.a,{className:"btnsize",icon:g.p})]}):Object(f.jsxs)("button",{className:"btn1 info",onClick:Z,children:[Object(f.jsx)("span",{className:"btn2",children:"Camera"}),Object(f.jsx)(x.a,{className:"btnsize",icon:g.o})]})}),Object(f.jsx)("div",{className:"col-silence",children:B?Object(f.jsxs)("button",{className:"btn1 info",onClick:$,children:[Object(f.jsx)("span",{className:"btn2",children:"Silence"}),Object(f.jsx)(x.a,{className:"btnsize",icon:g.l})]}):Object(f.jsxs)("button",{className:"btn1 info",onClick:$,children:[Object(f.jsx)("span",{className:"btn2",children:"Silence"}),Object(f.jsx)(x.a,{className:"btnsize",icon:g.e})]})})]}),Object(f.jsx)("div",{className:"col-emoji",children:Object(f.jsxs)("div",{className:"emojiPanel",style:{padding:"1rem"},children:[Object(f.jsxs)("div",{className:"reaction-container",children:[Object(f.jsx)("span",{className:"reaction-label-like",children:"Like"}),Object(f.jsx)("button",{id:"emoji-wink",className:"btn3 warning emojibuttons",style:{marginRight:"1rem"},children:Object(f.jsx)("span",{className:"reaction-entity",children:"\ud83d\udc4d"})})]}),Object(f.jsxs)("div",{className:"reaction-container",children:[Object(f.jsx)("span",{className:"reaction-label-dislike",children:"Dislike"}),Object(f.jsx)("button",{id:"emoji-eyes",className:"btn3 warning emojibuttons",style:{marginRight:"1rem"},children:Object(f.jsx)("span",{className:"reaction-entity",children:"\ud83d\udc4e"})})]}),Object(f.jsxs)("div",{className:"reaction-container",children:[Object(f.jsx)("span",{className:"reaction-label-love",children:"Love"}),Object(f.jsx)("button",{id:"emoji-heart",className:"btn3 warning emojibuttons",style:{marginRight:"1rem"},children:Object(f.jsx)("span",{className:"reaction-entity",children:"\u2764"})})]})]})})]})})})]})},w=function(){var e=Object(a.useState)(""),t=Object(d.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(""),o=Object(d.a)(i,2),s=o[0],u=o[1],m=Object(a.useState)(null),j=Object(d.a)(m,2),b=j[0],O=j[1],p=Object(a.useCallback)((function(e){u(e.target.value)}),[]),v=Object(a.useCallback)((function(e){c(e.target.value)}),[]),x=Object(a.useCallback)(function(){var e=Object(l.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,fetch("/video/token",{method:"POST",body:JSON.stringify({identity:n,room:s}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()}));case 3:a=e.sent,O(a.token);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[s,n]),g=Object(a.useCallback)((function(e){O(null)}),[]);return b?Object(f.jsx)(C,{meetingname:s,token:b,logout:g}):Object(f.jsx)(h,{username:n,roomName:s,handleUsernameChange:v,handleRoomNameChange:p,handleSubmit:x})};var T=function(){return Object(f.jsx)("div",{children:Object(f.jsx)(w,{})})};o.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)(T,{})}),document.getElementById("body"))},94:function(e,t){function n(e,t,n){("audio"===t?e.localParticipant.audioTracks:e.localParticipant.videoTracks).forEach((function(e){"mute"===n?(console.log("disable local audio"),e.track.disable()):e.track.enable()}))}t.muteYourAudio=function(e){n(e,"audio","mute")},t.muteYourVideo=function(e){n(e,"video","mute")},t.unmuteYourAudio=function(e){n(e,"audio","unmute")},t.unmuteYourVideo=function(e){n(e,"video","unmute")},t.participantMutedOrUnmutedMedia=function(e,t,n){e.on("trackSubscribed",(function(e,a,c){e.on("disabled",(function(){return t(e,c)})),e.on("enabled",(function(){return n(e,c)}))}))}}},[[222,1,2]]]);
//# sourceMappingURL=main.746bc307.chunk.js.map